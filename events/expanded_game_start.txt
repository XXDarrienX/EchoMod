############################
#
# Expanded Game Start Events
#
############################

namespace = gamestartexpanded

# Start-Up Events
event = {
	id = gamestartexpanded.1
	hide_window = yes
	fire_only_once = yes
	is_triggered_only = yes
	
	immediate = {
		set_global_flag = expanded_events_active
		# Spawn Unique Systems
		random_list = {
			60 = {
				random_system = {
					limit = { is_inside_nebula = yes }
					spawn_system = { initializer = "special_expanded_widow" }
				}
			}
			40 = {
				# Do not spawn
			}
		}
		random_list = {
			60 = {
				random_system = {
					limit = {
						NOT = { exists = space_owner }
						OR = {
							has_star_flag = enclave
							has_star_flag = primitive_system
						}
					}
					spawn_system = { initializer = "dune_arrakis_system" }
				}
			}
			40 = {
				# Do not spawn
			}
		}
		# Wasteful races can get damaged ecosystem on homeworld
		every_country = {
			limit = {
				any_owned_pop = {
					OR = {
						pop_has_trait = trait_wasteful
						pop_has_trait = trait_industrious
						pop_has_trait = trait_rapid_breeders
					}
				}
				NOR = {
					any_owned_pop = { pop_has_trait = trait_conservational }
					has_ethic = ethic_gestalt_consciousness
					has_valid_civic = civic_environmentalist
					has_valid_civic = civic_agrarian_idyll
					has_valid_civic = civic_life_seeded
					has_valid_civic = civic_post_apocalyptic
					has_valid_civic = civic_terraformer
					has_valid_civic = civic_subterranean_evolution
					has_valid_civic = civic_agribusiness
					has_valid_civic = civic_hmo
					has_valid_civic = civic_biological_engineering
					has_valid_civic = civic_natural_hunters
					has_country_flag = human_2 # capital is a colony
				}
			}
			country_event = { id = gamestartexpanded.8 days = 1 random = 10 }
		}
		# If any country UNE, chance to spawn CoM
		if = {
			limit = {
				any_country = { has_country_flag = human_1 }
				NOT = { any_country = { has_country_flag = human_2 } }
			}
			random_system = {
				limit = {
					NOT = { exists = space_owner }
					NOT = {
						any_neighbor_system = { exists = space_owner }
					}
					NOT = {
						any_system = {
							exists = space_owner
							distance = {
								source = PREV
								use_bypasses = no
								min_jumps = 1
								max_jumps = 5
							}
						}
					}
				}
				spawn_system = { initializer = "une_deneb_system" }
			}
		}
		# Start CoM event chain
		random_country = {
			limit = { has_country_flag = human_1 }
			country_event = { id = countryexpanded.30 days = 30 random = 30 }
		}
		if = {
			limit = { any_country = { has_country_flag = human_2 }  }
			random_country = {
				limit = { has_country_flag = human_2 }
				capital_scope = {
					if = {
						limit = { NOT = { has_deposit = d_chrysanthemum } }
						add_deposit = d_chrysanthemum
					}
				}
				country_event = { id = gamestartexpanded.2 days = 5 }
			}
		}
		
		# Set if game has planetary diversity
		if = {
			limit = {
				any_system = {
					any_system_planet = {
						is_planet_class = pc_ammonia
					}
				}
			}
			set_global_flag = has_planetary_diversity
		}
		
		### spawn some primitives###
		random_system = {
			limit = {
				NOT = { has_star_flag = primitive_system }
				OR = {
					NOT = { exists = space_owner }
					AND = {
						exists = space_owner 
						space_owner = {
							NOT = { is_country_type = fallen_empire }
							NOT = { is_country_type = awakened_fallen_empire }
							NOT = { is_country_type = default }
						}
					}
				}
			}
			spawn_system = { initializer = "special_init_02" }
		}
		random_system = {
			limit = {
				NOT = { has_star_flag = primitive_system }
				OR = {
					NOT = { exists = space_owner }
					AND = {
						exists = space_owner 
						space_owner = {
							NOT = { is_country_type = fallen_empire }
							NOT = { is_country_type = awakened_fallen_empire }
							NOT = { is_country_type = default }
						}
					}
				}
			}
			spawn_system = { initializer = "special_init_02" }
		}
		random_system = {
			limit = {
				NOT = { has_star_flag = primitive_system }
				OR = {
					NOT = { exists = space_owner }
					AND = {
						exists = space_owner 
						space_owner = {
							NOT = { is_country_type = fallen_empire }
							NOT = { is_country_type = awakened_fallen_empire }
							NOT = { is_country_type = default }
						}
					}
				}
			}
			spawn_system = { initializer = "special_init_02" }
		}
		# primitive near player
		random_system = {
			limit = {
				exists = space_owner
				space_owner = { is_ai = no }
			}
			random_system = {
				limit = {
					distance = {
						source = prev
						use_bypasses = no
						min_jumps = 6
						max_jumps = 24
					}
					NOT = { has_star_flag = primitive_system }
					OR = {
						NOT = { exists = space_owner }
						AND = {
							exists = space_owner 
							space_owner = {
								NOT = { is_country_type = fallen_empire }
								NOT = { is_country_type = awakened_fallen_empire }
								NOT = { is_country_type = default }
							}
						}
					}
				}
				spawn_system = { initializer = "special_init_02" }
			}
		}
		
		# Terraforming Candidates
		every_planet = {
			limit = {
				solar_system = {
					OR = {
						is_star_class = "sc_black_hole"
						is_star_class = "sc_neutron_star"
						is_star_class = "sc_pulsar"
						is_star_class = sc_o_super
						is_star_class = sc_o_hyper
						is_star_class = sc_b_super
						is_star_class = sc_a_super
						is_star_class = sc_f_super
						is_star_class = sc_g_super
						is_star_class = sc_k_super
						is_star_class = sc_m_super
						is_star_class = sc_m_hyper
						is_star_class = sc_nova_1
						is_star_class = sc_nova_2
						is_star_class = sc_collapsar
						is_star_class = sc_protostar
						is_star_class = sc_lbv_blue
						is_star_class = sc_lbv_green
						is_star_class = sc_lbv_red
						is_star_class = "sc_o"
						is_star_class = "sc_l"
						is_star_class = "sc_d"
						is_star_class = "sc_c_giant"
						is_star_class = "sc_s_giant"
						is_star_class = "sc_w_azure"
						is_star_class = "sc_w_red"
						is_star_class = "sc_w_green"
						is_star_class = "sc_w_purple"
						is_star_class = "sc_tt_red"
						is_star_class = "sc_tt_orange"
						is_star_class = "sc_tt_white"
						is_star_class = "sc_ae"
						is_star_class = "sc_p_purple"
						is_star_class = "sc_p_green"
						is_star_class = "sc_p_red"
						is_star_class = "sc_magnetar"
					}
				}
			}
			remove_modifier = terraforming_candidate
		}
		every_planet = {
			limit = {
				has_modifier = terraforming_candidate
				NOR = {
					is_planet_class = pc_barren
					is_planet_class = pc_barren_cold
				}
			}
			planet_event = { id = gamestartexpanded.5 days = 5 }
		}
		# Xenophobes less likely to be megacorps
		every_country = {
			limit = {
				is_xenophobe = yes
				has_authority = auth_corporate
				NOT = { has_valid_civic = civic_criminal_heritage }
				NOT = { has_valid_civic = civic_gospel_of_the_masses }
			}
			country_event = { id = gamestartexpanded.7 }
		}
	}
}

# Commonwealth of Man sets Earth as their homeworld
country_event = {
	id = gamestartexpanded.2
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_country = {
			limit = {
				OR = {
					has_country_flag = human_1
					has_country_flag = human_3
				}
			}
			capital_scope = { save_event_target_as = planet_earth }
		}
		owner_species = {
			set_species_homeworld = event_target:planet_earth
		}
	}
}

planet_event = {
	id = gamestartexpanded.5
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				is_planetary_diversity_active = no
			}
			remove_modifier = terraforming_candidate
		}
	}
}

# Space whales and amoebas reproduce
event = {
	id = gamestartexpanded.6
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				event_target:tiyanki_country = {
					count_owned_ships = { count < 99 } 
				}
			}
			random_list = {
				20 = {
					random_system = {
						limit = {
							NOT = { has_star_flag = hostile_system }
							any_system_planet = {
								is_gas_giant = yes
							}
							OR = {
								NOT = { exists = space_owner }
								space_owner = {
									is_homicidal = no
									is_ai = yes
								}
							}
						}
						create_tiyanki_country = yes
						random_system_planet = {
							limit = { is_gas_giant = yes }
							save_event_target_as = giant
							event_target:tiyanki_country = {
								save_event_target_as = tiyanki_country2
								create_fleet = {
									name = "NAME_Tiyanki_Space_Whale"
									effect = {
										set_owner = event_target:tiyanki_country
										create_ship = {
											name = "NAME_Cow"
											design = "NAME_Tiyanki_Cow"
										}
										create_ship = {
											name = "NAME_Bull"
											design = "NAME_Tiyanki_Bull"
										}
										create_ship = {
											name = "NAME_Calf"
											design = "NAME_Tiyanki_Calf"
										}
										set_location = event_target:giant
										set_fleet_stance = passive
										set_aggro_range_measure_from = return_point
										set_aggro_range = 0
										queue_actions = {
											wait = { # Cooldown until they start moving
												duration = 320
												random = 80
											}
											repeat = {
												find_random_system = {
													trigger = {
														id = "whale.x2.trigger.10"
														closest_system = {
															NOT = { has_star_flag = hostile_system }
															any_system_planet = {
																is_gas_giant = yes 
															}
														}
													}
													found_system = {
														move_to = this
													}
												}
												find_closest_planet = {
													trigger = {
														id = "whale.x2.trigger.11"
														is_gas_giant = yes
													}
													found_planet = {
														orbit_planet = this
														wait = {
															duration = 320
															random = 80
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
				80 = {
				}
			}
		}
		if = {
			limit = {
				event_target:amoeba_country = {
					count_owned_ships = { count < 99 } 
				}
			}
			random_list = {
				20 = {
					random_system = {
						limit = {
							NOT = { has_star_flag = hostile_system }
							OR = {
								NOT = { exists = space_owner }
								space_owner = {
									has_modifier = "pacified_amoebas"
									is_ai = yes
								}
							}
						}
						create_amoeba_country = yes
						random_system_planet = {
							limit = { is_star = no }
							save_event_target_as = grazing_grounds
							event_target:amoeba_country = {
								create_fleet = {
									name = "NAME_Space_Amoeba_Hunters"
									effect = {
										set_owner = event_target:amoeba_country
										random_list = {
											20 = {
												set_fleet_flag = tiyanki_hunter
											}
											70 = {
												set_fleet_flag = empty_system
											}
										}
										while = {
											count = 4
											create_ship = {
												name = ""
												design = "NAME_Small_Space_Organism_Orange"
											}
										}
										while = {
											count = 1
											create_ship = {
												name = ""
												design = "NAME_Large_Space_Organism_Orange"
											}
										}
										set_location = PREVPREV
										set_fleet_stance = aggressive
										set_aggro_range_measure_from = self
										set_aggro_range = 20

										if = {
											limit = { has_fleet_flag = tiyanki_hunter }
											save_event_target_as = hunting_amoeba
											queue_actions = {
												repeat = {
													find_random_system = {
														trigger = {
															id = "whale.x2.trigger.12"
															closest_system = {
																any_ship_in_system = {
																	is_ship_size = space_whale_3
																	#hunt calves
																}
															}
														}
														found_system = {
															move_to = this
														}
													}
													find_closest_planet = {
														trigger = {
															id = "whale.x2.trigger.130"
															is_star = yes
														}
														found_planet = {
															effect = { 
																event_target:hunting_amoeba = { set_aggro_range = 500 }
															}
															orbit_planet = this
															wait = {
																duration = 300
																random = 10
															}
														}
													}
													find_random_system = {
														trigger = {
															id = "whale.x2.trigger.14"
															closest_system = {
																any_system_planet = {
																	is_planet = event_target:grazing_grounds
																}
															}
														}
														found_system = {
															move_to = this
														}
													}
													find_closest_planet = {
														trigger = {
															id = "whale.x2.trigger.150"
															is_planet = event_target:grazing_grounds
														}
														found_planet = {
															effect = { 
																event_target:hunting_amoeba = { set_aggro_range = 40 }
															}
															orbit_planet = this
															wait = {
																duration = 400
																random = 150
															}
														}
													}
												}
											}
											else = {
												queue_actions = {
													repeat = {
														find_random_system = {
															trigger = {
																id = "whale.x2.trigger.16"
																closest_system = {
																	NOT = { has_star_flag = hostile_system }
																}
															}
															found_system = {
																move_to = this
															}
														}
														find_closest_planet = {
															trigger = {
																id = "whale.x2.trigger.17"
																is_star = yes
															}
															found_planet = {
																orbit_planet = this
																wait = {
																	duration = 100
																	random = 50
																}
															}
														}
														find_random_system = {
															trigger = {
																id = "whale.x2.trigger.18"
																closest_system = {
																	any_system_planet = {
																		is_planet = event_target:grazing_grounds
																	}
																}
															}
														}
														find_closest_planet = {
															trigger = {
																id = "whale.x2.trigger.19"
																is_planet = event_target:grazing_grounds
															}
															found_planet = {
																orbit_planet = this
																wait = {
																	duration = 300
																	random = 50
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
				80 = {
				}
			}
		}
	}
}

country_event = {
	id = gamestartexpanded.7
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			50 = {
			}
			40 = {
				change_government = {
					authority = auth_oligarchic
					civics = random
				}
			}
			10 = {
				change_government = {
					authority = auth_corporate
					civics = {
						civic = civic_gospel_of_the_masses
						civic = civic_criminal_heritage
					}
				}
			}
		}
	}
}

country_event = {
	id = gamestartexpanded.8
	id = gamestartexpanded.8
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			30 = {
				modifier = {
					factor = 1.5
					has_country_flag = human_1
				}
				modifier = {
					factor = 1.5
					OR = {
						has_authority = auth_corporate
						has_civic = civic_corporate_dominion
					}
				}
				modifier = {
					factor = 1.5
					OR = {
						has_civic = civic_mining_guilds
						has_civic = civic_mining_company
					}
				}
				modifier = {
					factor = 1.5
					any_owned_pop = {
						AND = {
							pop_has_trait = trait_wasteful
							pop_has_trait = trait_industrious
						}
					}
				}
				country_event = { id = countryexpanded.20 days = 60 random = 120 }
			}
			70 = {
				# nothing
			}
		}
	}
}