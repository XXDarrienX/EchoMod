namespace = vb_psi_souleater

@starving = 5
@hungry = 10
@peckish = 15
@fed = 20
@well_fed = 25
@full = 30
@engorged = 35
@max = 25000
@food_factor = 1

#Initial setting for soul eaters
country_event = {
	id = vb_psi_souleater.1
	hide_window = yes
	is_triggered_only = yes
	
	trigger = { has_civic = civic_vb_psi_soul_eater }
	
	immediate = {
		add_modifier = {
			modifier = vb_psi_food_level_7
			days = -1
		}
	}
}

#Launching eating calculator
event = {
	id = vb_psi_souleater.2
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		years_passed >= 30 
	}
	
	immediate = {
		every_playable_country = {
			limit = {
				has_civic = civic_vb_psi_soul_eater
			}
			country_event = { id = vb_psi_souleater.3 }
			country_event = { id = vb_psi_souleater.5 days = 5}
		}
	}
	
}

#Eating calculator
country_event = {
	id = vb_psi_souleater.3
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		while = {
			limit = {
				check_variable = { which = vb_psi_food value > 0 }
				any_owned_pop = {
					has_trait = trait_vb_psi_soul_eater
					NOT = { has_pop_flag = vb_psi_fed }
				}
			}
			every_owned_pop = {
				limit = {
					has_trait = trait_vb_psi_soul_eater
					NOT = { has_pop_flag = vb_psi_fed }
				}
				set_timed_pop_flag = {
					flag = vb_psi_fed
					days = 1
				}
				prev = {
					change_variable = { which = vb_psi_food value = -1 }
				}
			}
		}
		while = {
			limit = { 
				check_variable = { which = vb_psi_food value < @max }
				any_owned_pop = {
					NOR = {
						has_trait = trait_vb_psi_soul_eater 
						has_pop_flag = vb_psi_eaten
						has_trait = "trait_robotic_1"
						has_trait = "trait_robotic_2"
						has_trait = "trait_robotic_3"
						has_trait = trait_cybernetic
						has_trait = trait_mechanical
						has_trait = trait_machine_unit
					}
					has_slavery_type = {
						type = slavery_livestock
						country = from
					}
				}
			}
			every_owned_pop = {
				limit = {
					NOR = {
						has_trait = trait_vb_psi_soul_eater 
						has_pop_flag = vb_psi_eaten
						has_trait = "trait_robotic_1"
						has_trait = "trait_robotic_2"
						has_trait = "trait_robotic_3"
						has_trait = trait_cybernetic
						has_trait = trait_mechanical
						has_trait = trait_machine_unit
					}
					has_slavery_type = {
						type = slavery_livestock
						country = from
					}
				}
				set_timed_pop_flag = {
					flag = vb_psi_eaten
					days = 1
				}
				prev = {
					change_variable = { which = vb_psi_food value = @food_factor }
				}
				IF = {
					limit = {
						OR = {
							has_trait = trait_latent_psionic
							has_trait = trait_psionic
							has_trait = trait_hive_mind
							has_trait = trait_vb_psi_delicious_psionic
						}
						has_slavery_type = {
							type = slavery_livestock
							country = from
						}
					}
					prev = {
						change_variable = { which = vb_psi_food value = 5 }
					}
				}
				add_modifier = {
					modifier = vb_psi_soul_malaise
					days = 360
				}
				random_list = {
					5 = { #Pop actually died
						kill_pop = yes
					}
					95 = {  }
				}
			}
		}		
		vb_psi_calculate_sustenance = yes
	}
}

country_event = {
	id = vb_psi_souleater.4
	title = "vb_psi_souleater.4.name"
	desc = "vb_psi_souleater.4.desc"
	picture = GFX_evt_psionics
	show_sound = event_mind_over_matter
	is_triggered_only = yes

	option = {
		name = Excellent
	}
}

country_event = {
	id = vb_psi_souleater.5
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_civic = civic_vb_psi_soul_eater
	}

	immediate = {
		IF = {
		limit = {
			check_variable = {
				which = vb_psi_food
				value < 0
			}
		}
		set_variable = { which = vb_psi_food value = 0 }
		}
	}
}

country_event = {
	id = vb_psi_souleater.6
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_playable_country = {
			limit = {
				is_ai = no
			}
			country_event = {
				id = vb_psi_souleater.7
				days = 10800
			}
		}
	}
}

country_event = {
	id = vb_psi_souleater.7
	title = "vb_psi_souleater.7.name"
	desc = "vb_psi_souleater.7.desc"
	is_triggered_only = yes
	picture = GFX_evt_psionics
	show_sound = event_mind_over_matter

	option = {
		name = OK
	}
}