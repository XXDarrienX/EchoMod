#################################
#
# Envoy Events
# by Pierre du Plessis
#
#################################

namespace = envoy_events

#insulting envoy software event
country_event = {
	id = envoy_events.1
	title = envoy_events.1.name
	desc = envoy_events.1.desc
	picture = GFX_evt_assembly_fight
	show_sound = event_assembly_fight

	is_triggered_only = yes

	trigger = {
		is_country_type = default
		any_relation = {
			is_improving_relations_with = root
			NOT = { has_country_flag = recent_envoy_event }
			NOT = { is_same_species = root }
			NOT = { is_same_species = root.ruler }
			any_envoy = {
				has_envoy_task = {
					task = improve_relations
					target = root
				}
				NOT = { is_same_species = root }
				NOT = { is_same_species = root.ruler }
			}
		}
		NOT = { has_country_flag = recent_envoy_event }
	}

	immediate = {
		set_timed_country_flag = {
			flag = recent_envoy_event
			days = 5400
		}
		random_relation = {
			limit = {
				is_improving_relations_with = root
				NOT = { has_country_flag = recent_envoy_event }
				NOT = { is_same_species = root }
				NOT = { is_same_species = root.ruler }
				any_envoy = {
					has_envoy_task = {
						task = improve_relations
						target = root
					}
					NOT = { is_same_species = root }
					NOT = { is_same_species = root.ruler }
				}
			}
			set_timed_country_flag = {
				flag = recent_envoy_event
				days = 5400
			}
			save_event_target_as = envoy_source
			random_envoy = {
				limit = {
					has_envoy_task = {
						task = improve_relations
						target = root
					}
					NOT = { is_same_species = root }
					NOT = { is_same_species = root.ruler }
				}
				save_event_target_as = event_envoy
			}
		}
		ruler.species = {
			save_event_target_as = ruler_species
		}
	}

	option = {
		name = envoy_events.1.A
		add_resource = {
			influence = 30
		}
		tooltip = {
			add_opinion_modifier = {
				who = event_target:envoy_source
				modifier = opinion_envoy_insult_taken
			}
		}
		hidden_effect = { set_country_flag = envoy_insult_taken }

		ai_chance = {
			factor = 1
			modifier = {
				factor = 0.25
				OR = {
					has_defensive_pact = event_target:envoy_source
					is_in_federation_with = event_target:envoy_source
				}
			}
			modifier = {
				factor = 0.5
				opinion_level = {
					who = event_target:envoy_source
					level >= good
				}
			}
			modifier = {
				factor = 2
				opinion_level = {
					who = event_target:envoy_source
					level <= poor
				}
			}
			modifier = {
				factor = 2
				is_rival = event_target:envoy_source
			}
		}
	}
	option = {
		name = envoy_events.1.B

		add_modifier = {
			modifier = xeno_comedy_envoy
			days = 3600
		}

		tooltip = {
			add_opinion_modifier = {
				who = event_target:envoy_source
				modifier = opinion_envoy_insult_laughed_at
			}
		}
		hidden_effect = { set_country_flag = envoy_insult_laughed_at }
	}

	after = {
		hidden_effect = {
			event_target:envoy_source = {
				country_event = { id = envoy_events.2 }
			}
		}
	}
}

#insulting envoy software event
country_event = {
	id = envoy_events.2
	title = envoy_events.2.name
	desc = {
		text = envoy_events.2.desc.neg
		trigger = {
			from = { has_country_flag = envoy_insult_taken }
		}
	}
	desc = {
		text = envoy_events.2.desc.pos
		trigger = {
			from = { has_country_flag = envoy_insult_laughed_at }
		}
	}
	picture = GFX_evt_assembly_fight
	show_sound = event_assembly_fight

	is_triggered_only = yes

	option = {
		name = UNFORTUNATE
		trigger = {
			from = { has_country_flag = envoy_insult_taken }
		}
		from = {
			add_opinion_modifier = {
				who = root
				modifier = opinion_envoy_insult_taken
			}
		}
	}
	option = {
		name = envoy_events.2.B
		trigger = {
			from = { has_country_flag = envoy_insult_laughed_at }
		}
		from = {
			add_opinion_modifier = {
				who = root
				modifier = opinion_envoy_insult_laughed_at
			}
		}
	}

	after = {
		hidden_effect = {
			from = {
				remove_country_flag = envoy_insult_taken
				remove_country_flag = envoy_insult_laughed_at
			}
		}
	}
}

# A Contribution to Galactic Comedy
country_event = {
	id = envoy_events.3
	title = envoy_events.3.name
	desc = {
		text = envoy_events.3.desc
		trigger = {
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
	}
	desc = {
		text = envoy_events.3.desc.hive
		trigger = {
			has_authority = auth_hive_mind
		}
	}
	desc = {
		text = envoy_events.3.desc.machine
		trigger = {
			has_authority = auth_machine_intelligence
		}
	}
	picture = GFX_evt_galactic_community
	show_sound = event_galactic_community

	trigger = {
		is_country_type = default
		NOT = { has_country_flag = recent_envoy_event }
		is_galactic_community_member = yes
		any_country = {
			is_part_of_galactic_council = yes
			NOT = { is_same_species = root }
			NOT = { is_in_federation_with = root }
			NOT = { has_defensive_pact = root }
			NOT = { is_overlord_to = root }
		}
		any_country = {
			is_galactic_community_member = yes
			is_part_of_galactic_council = no
			relative_power = {
				who = root
				value < equivalent
			}
			NOT = { is_same_species = root }
			NOT = { is_in_federation_with = root }
			NOT = { has_defensive_pact = root }
			NOT = { has_overlord = root }
		}
		any_envoy = {
			leader_age < 50
			has_envoy_cooldown = yes #fairly limiting trigger
			has_envoy_task = {
				task = galactic_community
			}
		}
	}

	is_triggered_only = yes

	immediate = {
		set_timed_country_flag = {
			flag = recent_envoy_event
			days = 5400
		}
		random_country = {
			limit = {
				is_part_of_galactic_council = yes
				NOT = { is_same_species = root }
				NOT = { is_in_federation_with = root }
				NOT = { has_defensive_pact = root }
				NOT = { is_overlord_to = root }
			}
			save_event_target_as = council_country
		}
		random_country = {
			limit = {
				is_galactic_community_member = yes
				is_part_of_galactic_council = no
				relative_power = {
					who = root
					value < equivalent
				}
				NOT = { is_same_species = root }
				NOT = { is_in_federation_with = root }
				NOT = { has_defensive_pact = root }
				NOT = { has_overlord = root }
			}
			save_event_target_as = pathetic_country
		}
		random_envoy = {
			limit = {
				leader_age < 50
				has_envoy_task = {
					task = galactic_community
				}
			}
			save_event_target_as = event_envoy
			set_leader_flag = silly_envoy
		}
	}

	option = {
		name = {
			text = envoy_events.3.A
			trigger = {
				OR = {
					is_militarist = yes
					is_xenophobe = yes
					is_authoritarian = yes
					is_gestalt = yes
				}
				is_pacifist = no
			}
		}
		name = {
			text = envoy_events.3.B
			trigger = {
				OR = {
					AND = {
						is_militarist = no
						is_xenophobe = no
						is_authoritarian = no
						is_gestalt = no
					}
					is_pacifist = yes
				}
			}
		}

		add_modifier = {
			modifier = galactic_community_diplo_corps_is_a_joke
			days = 3600
		}
	}
	option = {
		name = {
			text = envoy_events.3.C1
			trigger = {
				is_gestalt = no
			}
		}
		name = {
			text = envoy_events.3.C2
			trigger = {
				is_hive_empire = yes
			}
		}
		name = {
			text = envoy_events.3.C3
			trigger = {
				is_machine_empire = yes
			}
		}
		event_target:event_envoy = {
			unassign_leader = this
			set_cooldown = 1080
		}
	}
}

# Respected Envoy to Galactic Community
country_event = {
	id = envoy_events.4
	title = envoy_events.4.name
	desc = {
		text = envoy_events.4.desc
		trigger = {
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
	}
	desc = {
		text = envoy_events.4.desc.hive
		trigger = {
			has_authority = auth_hive_mind
		}
	}
	desc = {
		text = envoy_events.4.desc.machine
		trigger = {
			has_authority = auth_machine_intelligence
		}
	}
	picture = GFX_evt_galactic_community
	show_sound = event_galactic_community

	trigger = {
		is_country_type = default
		NOT = { has_country_flag = recent_envoy_event }
		is_galactic_community_member = yes
		is_part_of_galactic_council = no
		galactic_community_rank >= 5
		any_envoy = {
			leader_age > 60
			has_envoy_task = {
				task = galactic_community
			}
			NOT = { has_leader_flag = silly_envoy }
		}
	}

	is_triggered_only = yes

	immediate = {
		set_timed_country_flag = {
			flag = recent_envoy_event
			days = 5400
		}
		random_envoy = {
			limit = {
				leader_age > 60
				has_envoy_task = {
					task = galactic_community
				}
				NOT = { has_leader_flag = silly_envoy }
			}
			save_event_target_as = event_envoy
			set_leader_flag = silly_envoy
		}
	}

	option = {
		name = EXCELLENT

		add_modifier = {
			modifier = galactic_community_diplo_corps_respected
			days = 3600
		}
	}
}


# Irritating Envoy Must Die
country_event = {
	id = envoy_events.5
	title = envoy_events.5.name
	desc = envoy_events.5.desc
	picture = GFX_evt_assembly_fight
	show_sound = event_assembly_fight

	is_triggered_only = yes

	trigger = {
		is_country_type = default
		is_gestalt = no
		NOT = { has_ethic = ethic_fanatic_egalitarian } #just a bit weird
		NOT = { has_country_flag = recent_envoy_event }
		any_relation = {
			is_harming_relations_with = root
			any_envoy = {
				has_envoy_task = {
					task = harm_relations
					target = root
				}
			}
			is_gestalt = no
			NOT = { has_country_flag = recent_envoy_event }
		}
		any_pop_faction = {
			NOT = { is_pop_faction_type = progressive }
			NOT = { is_pop_faction_type = prosperity }
			NOT = { is_pop_faction_type = xenoist }
			is_owner_ethic_pop_faction = yes
		}
	}

	immediate = {
		set_timed_country_flag = {
			flag = recent_envoy_event
			days = 5400
		}
		random_relation = {
			limit = {
				is_harming_relations_with = root
				any_envoy = {
					has_envoy_task = {
						task = harm_relations
						target = root
					}
				}
				is_gestalt = no
				NOT = { has_country_flag = recent_envoy_event }
			}
			save_event_target_as = envoy_source
			random_envoy = {
				limit = {
					has_envoy_task = {
						task = harm_relations
						target = root
					}
				}
				save_event_target_as = event_envoy
			}
		}
	}

	option = {
		name = envoy_events.5.A
		add_resource = {
			influence = -30
		}

		ai_chance = {
			factor = 2
			modifier = {
				factor = 2
				OR = {
					is_egalitarian = yes
					is_xenophile = yes
					is_pacifist = yes
				}
			}
		}
	}
	option = {
		name = envoy_events.5.B

		tooltip = {
			add_modifier = {
				modifier = kills_envoys
				days = 3600
			}
		}

		random_pop_faction = {
			limit = {
				NOT = { is_pop_faction_type = progressive }
				NOT = { is_pop_faction_type = prosperity }
				NOT = { is_pop_faction_type = xenoist }
				is_owner_ethic_pop_faction = yes
			}
			add_modifier = {
				modifier = faction_modifier_protected_interests
				days = 3600
			}
		}
		
		event_target:envoy_source = {
			tooltip = {
				add_opinion_modifier = {
					who = root
					modifier = opinion_kills_envoys
				}
			}
			hidden_effect = {
				country_event = { id = envoy_events.6 days = 5 }
				set_timed_country_flag = {
					flag = recent_envoy_event
					days = 5400
				}
			}
		}

		tooltip = {
			if = {
				limit = {
					is_in_federation_with = event_target:envoy_source
				}
				federation = {
					add_cohesion = -50
				}
			}
			event_target:event_envoy = {
				kill_leader = {
					show_notification = no
				}
			}
		}

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				OR = {
					is_authoritarian = yes
					is_xenophobe = yes
					is_militarist = yes
				}
			}
			modifier = {
				factor = 2
				is_rival = event_target:envoy_source
			}
		}
	}
}

# Irritating Envoy Must Die - envoy country
country_event = {
	id = envoy_events.6
	title = envoy_events.6.name
	desc = envoy_events.6.desc
	picture = GFX_evt_assembly_fight
	show_sound = event_assembly_fight

	is_triggered_only = yes

	option = {
		name = envoy_events.6.A

		add_opinion_modifier = {
			who = from
			modifier = opinion_kills_envoys
		}
		if = {
			limit = {
				is_in_federation_with = from
			}
			federation = {
				add_cohesion = -50
			}
		}
		from = {
			add_modifier = {
				modifier = kills_envoys
				days = 3600
			}
		}
		event_target:event_envoy = {
			kill_leader = {
				show_notification = yes
			}
		}
	}
}


# Xenophobe Envoy Elopes
country_event = {
	id = envoy_events.7
	title = envoy_events.7.name
	desc = envoy_events.7.desc
	
	picture = GFX_evt_diplomatic_visit
	show_sound = event_default
	
	trigger = {
		is_country_type = default
		is_xenophobe = yes
		NOT = { has_valid_civic = civic_fanatic_purifiers }
		NOT = { has_country_flag = recent_envoy_event }
		any_envoy = {
			NOT = {
				has_envoy_task = {
					task = none
				}
			}
			OR = {
				AND = {
					OR = {
						has_envoy_task = {
							task = harm_relations
						}
						has_envoy_task = {
							task = improve_relations
						}
					}
					envoy_location_country = {
						is_gestalt = no
						NOT = { is_same_species = prev }
						NOT = { is_same_species = root }
						any_relation = {
							is_xenophile = yes
							has_communications = root
							is_at_war = no
							NOT = { has_country_flag = recent_envoy_event }
							has_policy_flag = refugees_allowed
						}
					}
				}
				AND = {
					has_envoy_task = {
						task = federation
					}
					root.federation = {
						any_member = {
							is_gestalt = no
							NOT = { is_same_species = root }
							NOT = { is_same_species = prevprev }
							any_relation = {
								is_xenophile = yes
								has_communications = root
								is_at_war = no
								NOT = { has_country_flag = recent_envoy_event }
								has_policy_flag = refugees_allowed
							}
						}
					}
				}
				AND = {
					has_envoy_task = {
						task = galactic_community
					}
					any_country = {
						is_gestalt = no
						is_galactic_community_member = yes
						NOT = { is_same_species = root }
						NOT = { is_same_species = prev }
						any_relation = {
							is_xenophile = yes
							has_communications = root
							is_at_war = no
							NOT = { has_country_flag = recent_envoy_event }
							has_policy_flag = refugees_allowed
						}
					}
				}
			}
		}
	}

	is_triggered_only = yes

	immediate = {
		set_timed_country_flag = {
			flag = recent_envoy_event
			days = 5400
		}
		
		random_envoy = {
			limit = {
				NOT = {
					has_envoy_task = {
						task = none
					}
				}
				OR = {
					AND = {
						OR = {
							has_envoy_task = {
								task = harm_relations
							}
							has_envoy_task = {
								task = improve_relations
							}
						}
						envoy_location_country = {
							is_gestalt = no
							NOT = { is_same_species = prev }
							NOT = { is_same_species = root }
							any_relation = {
								is_xenophile = yes
								has_communications = root
								is_at_war = no
								NOT = { has_country_flag = recent_envoy_event }
								has_policy_flag = refugees_allowed
							}
						}
					}
					AND = {
						has_envoy_task = {
							task = federation
						}
						root.federation = {
							any_member = {
								is_gestalt = no
								NOT = { is_same_species = root }
								NOT = { is_same_species = prevprev }
								any_relation = {
									is_xenophile = yes
									has_communications = root
									is_at_war = no
									NOT = { has_country_flag = recent_envoy_event }
									has_policy_flag = refugees_allowed
								}
							}
						}
					}
					AND = {
						has_envoy_task = {
							task = galactic_community
						}
						any_country = {
							is_gestalt = no
							is_galactic_community_member = yes
							NOT = { is_same_species = root }
							NOT = { is_same_species = prev }
							any_relation = {
								is_xenophile = yes
								has_communications = root
								is_at_war = no
								NOT = { has_country_flag = recent_envoy_event }
								has_policy_flag = refugees_allowed
							}
						}
					}
				}
			}
			save_event_target_as = event_envoy
			if = {
				limit = {
					OR = {
						has_envoy_task = {
							task = harm_relations
						}
						has_envoy_task = {
							task = improve_relations
						}
					}
					envoy_location_country = {
						is_gestalt = no
						NOT = { is_same_species = prev }
						NOT = { is_same_species = root }
						any_relation = {
							is_xenophile = yes
							has_communications = root
							is_at_war = no
							NOT = { has_country_flag = recent_envoy_event }
							has_policy_flag = refugees_allowed
						}
					}
				}
				envoy_location_country = {
					save_event_target_as = other_species_nation
				}
			}
			else_if = {
				limit = {
					has_envoy_task = {
						task = federation
					}
					root.federation = {
						any_member = {
							is_gestalt = no
							NOT = { is_same_species = root }
							NOT = { is_same_species = prevprev }
							any_relation = {
								is_xenophile = yes
								has_communications = root
								is_at_war = no
								NOT = { has_country_flag = recent_envoy_event }
								has_policy_flag = refugees_allowed
							}
						}
					}
				}
				root.federation = {
					random_member = {
						limit = {
							is_gestalt = no
							NOT = { is_same_species = root }
							NOT = { is_same_species = prevprev }
							any_relation = {
								is_xenophile = yes
								has_communications = root
								is_at_war = no
								NOT = { has_country_flag = recent_envoy_event }
								has_policy_flag = refugees_allowed
							}
						}
						save_event_target_as = other_species_nation
					}
				}
			}
			else = {
				random_country = {
					limit = {
						is_gestalt = no
						is_galactic_community_member = yes
						NOT = { is_same_species = root }
						NOT = { is_same_species = prev }
						any_relation = {
							is_xenophile = yes
							has_communications = root
							is_at_war = no
							NOT = { has_country_flag = recent_envoy_event }
							has_policy_flag = refugees_allowed
						}
					}
					save_event_target_as = other_species_nation
				}
			}
			exile_leader_as = star_crossed_lover_envoy
		}
		event_target:other_species_nation = {
			random_relation = {
				limit = {
					is_xenophile = yes
					has_communications = root
					NOT = { has_country_flag = recent_envoy_event }
				}
				save_event_target_as = third_party
			}
		}
	}
	option = {
		name = envoy_events.7.A
		trigger = {
			num_favors = {
				target = event_target:third_party
				value >= 2
			}
		}
		remove_favors = {
			target = event_target:third_party
			value = 2
		}
		ai_chance = {
			factor = 2
			modifier = {
				factor = 0.5
				event_target:third_party = {
					relative_power = {
						who = root
						value >= superior
					}
				}
			}
			modifier = {
				factor = 0.5
				event_target:third_party = {
					relative_power = {
						who = root
						value = overwhelming
					}
				}
			}
			modifier = {
				factor = 2
				event_target:third_party = {
					relative_power = {
						who = root
						value = pathetic
					}
				}
			}
		}
	}
	option = {
		name = envoy_events.7.B
		custom_tooltip = envoy_events.7.B.tooltip
		hidden_effect = {
			event_target:third_party = {
				country_event = { id = envoy_events.8 days = 15 }
			}
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				event_target:third_party = {
					opinion_level = {
						who = root
						level <= poor
					}
				}
			}
			modifier = {
				factor = 2
				event_target:third_party = {
					opinion_level = {
						who = root
						level >= good
					}
				}
			}
		}
	}
	option = {
		name = envoy_events.7.D
		add_modifier = {
			modifier = diplo_corps_lost_control
			days = 3600
		}
		ai_chance = {
			factor = 0.5
		}
	}
}

# Approached asked to extradite the envoy
country_event = {
	id = envoy_events.8
	title = TRANSMISSION
	desc = envoy_events.8.desc
	show_sound = event_default
	diplomatic = yes
	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}
	is_triggered_only = yes
	trigger = {
		exists = from
	}
	
	option = {
		name = envoy_events.8.A

		tooltip = {
			add_favors = {
				target = from
				value = 2
			}
		}
		from = {
			add_opinion_modifier = {
				who = root
				modifier = opinion_extradited_envoy
			}
			hidden_effect = {
				country_event = { id = envoy_events.9 }
			}
		}
		ai_chance = {
			factor = 2
			modifier = {
				factor = 0.33
				opinion_level = {
					who = from
					level <= poor
				}
			}
			modifier = {
				factor = 0.33
				opinion_level = {
					who = from
					level <= terrible
				}
			}
			modifier = {
				factor = 2
				opinion_level = {
					who = from
					level >= good
				}
			}
			modifier = {
				factor = 2
				opinion_level = {
					who = from
					level >= excellent
				}
			}
		}
	}
	option = {
		name = envoy_events.8.B

		from = {
			add_opinion_modifier = {
				who = root
				modifier = opinion_refused_extradited_envoy
			}
			hidden_effect = {
				country_event = { id = envoy_events.10 }
			}
		}
		ai_chance = {
			factor = 1
		}
	}
}

# Positive Response
country_event = {
	id = envoy_events.9
	title = THEIR_RESPONSE
	desc = envoy_events.9.desc
	show_sound = event_default
	diplomatic = yes
	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}
	is_triggered_only = yes

	option = {
		name = envoy_events.9.A
		from = {
			add_favors = {
				target = root
				value = 2
			}
		}
	}
}

# Negative Response
country_event = {
	id = envoy_events.10
	title = THEIR_RESPONSE
	desc = envoy_events.10.desc
	show_sound = event_default
	diplomatic = yes
	picture_event_data = {
		portrait = from
		planet_background = from
		graphical_culture = from
		city_level = from
		room = from.ruler
	}
	is_triggered_only = yes

	option = { #ah well
		name = envoy_events.10.A
		add_modifier = {
			modifier = diplo_corps_lost_control
			days = 3600
		}
		ai_chance = {
			factor = 2
		}
	}

	option = { #send in the special ops
		name = envoy_events.10.B
		custom_tooltip = envoy_events.10.B.tooltip1
		
		random_list = {
			2 = { #success
				custom_tooltip = envoy_events.10.B.success_tooltip
				tooltip = {
					add_resource = {
						influence = 30
					}
				}
				hidden_effect = { event_target:third_party = { country_event = { id = envoy_events.11 days = 63 } } }
				modifier = {
					factor = 1.5
					is_militarist = yes
				}
				modifier = {
					factor = 0.75
					is_pacifist = yes
				}
				modifier = {
					factor = 0.75
					event_target:third_party = { is_militarist = yes }
				}
				modifier = {
					factor = 1.5
					event_target:third_party = { is_pacifist = yes }
				}
				modifier = {
					factor = 1.5
					relative_power = {
						who = event_target:third_party
						value >= superior
					}
				}
				modifier = {
					factor = 1.5
					relative_power = {
						who = event_target:third_party
						value = overwhelming
					}
				}
				modifier = {
					factor = 0.75
					relative_power = {
						who = event_target:third_party
						value <= inferior
					}
				}
				modifier = {
					factor = 0.75
					relative_power = {
						who = event_target:third_party
						value = pathetic
					}
				}
				modifier = {
					factor = 1.5
					event_target:third_party = {
						opinion_level = {
							who = root
							level >= good #less suspicious
						}
					}
				}
				modifier = {
					factor = 0.75
					event_target:third_party = {
						opinion_level = {
							who = root
							level <= poor #more suspicious
						}
					}
				}
			}
			1 = { #failure
				custom_tooltip = envoy_events.10.B.fail_tooltip
				tooltip = {
					add_modifier = {
						modifier = failed_special_ops_mission
						days = 3600
					}
				}
				hidden_effect = { event_target:third_party = { country_event = { id = envoy_events.13 days = 63 } } }
			}
		}

		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				event_target:third_party = {
					opinion_level = {
						who = root
						level <= poor
					}
				}
			}
			modifier = {
				factor = 0
				event_target:third_party = {
					opinion_level = {
						who = root
						level >= good
					}
				}
			}
			modifier = {
				factor = 0.5
				is_pacifist = yes
			}
			modifier = {
				factor = 1.5
				relative_power = {
					who = event_target:third_party
					value >= superior
				}
			}
			modifier = {
				factor = 0.75
				relative_power = {
					who = event_target:third_party
					value <= inferior
				}
			}
		}
	}
}

#Successful special ops mission - third party
country_event = {
	id = envoy_events.11
	title = envoy_events.11.name
	desc = envoy_events.11.desc
	picture = GFX_evt_archaeologists_escaping
	show_sound = event_default
	is_triggered_only = yes

	option = {
		name = envoy_events.11.A
		add_modifier = {
			modifier = cannot_protect_asylum
			days = 3600
		}
		hidden_effect = {
			from = { country_event = { id = envoy_events.12 } }
		}
	}
}

#Successful special ops mission - starter country
country_event = {
	id = envoy_events.12
	title = envoy_events.12.name
	desc = envoy_events.12.desc
	picture = GFX_evt_archaeologists_escaping
	show_sound = event_celebration
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		add_resource = {
			influence = 30
		}
		from = {
			add_opinion_modifier = {
				who = root
				modifier = opinion_special_ops_vs_us
			}
		}
	}
}


#Failed special ops mission - third party
country_event = {
	id = envoy_events.13
	title = envoy_events.13.name
	desc = envoy_events.13.desc
	
	picture = GFX_evt_diplomatic_visit #todo
	show_sound = event_default
	is_triggered_only = yes

	option = {
		name = envoy_events.13.A
		tooltip = {
			from = {
				add_modifier = {
					modifier = failed_special_ops_mission
					days = 3600
				}
			}
		}
		hidden_effect = {
			from = { country_event = { id = envoy_events.14 } }
		}
	}
}

#Failed special ops mission - starter country
country_event = {
	id = envoy_events.14
	title = envoy_events.14.name
	desc = envoy_events.14.desc
	picture = GFX_evt_archaeologists_escaping
	show_sound = event_air_raid_siren
	is_triggered_only = yes
	
	option = {
		name = UNFORTUNATE
		add_modifier = {
			modifier = failed_special_ops_mission
			days = 3600
		}
		from = {
			add_opinion_modifier = {
				who = root
				modifier = opinion_special_ops_vs_us
			}
		}
	}
}


# Miaow
country_event = {
	id = envoy_events.15
	title = envoy_events.15.name
	desc = envoy_events.15.desc
	
	picture = GFX_evt_galactic_community
	show_sound = event_galactic_community

	trigger = {
		is_country_type = default
		NOT = { has_country_flag = recent_envoy_event }
		is_galactic_community_member = yes
		is_gestalt = no
		NOR = {
			species_portrait = human
			has_country_flag = human_1
			has_country_flag = human_2
		}
		any_country = {
			is_galactic_community_member = yes
			NOT = { is_in_federation_with = root }
			NOT = { is_overlord_to = root }
			NOT = { root = { is_overlord_to = prev } }
			OR = {
				has_country_flag = human_1
				has_country_flag = human_2
			}
		}
		any_envoy = {
			is_same_species = root
			has_envoy_task = {
				task = galactic_community
			}
		}
	}

	is_triggered_only = yes

	immediate = {
		set_timed_country_flag = {
			flag = recent_envoy_event
			days = 5400
		}
		random_envoy = {
			limit = {
				is_same_species = root
				has_envoy_task = {
					task = galactic_community
				}
			}
			save_event_target_as = event_envoy
		}
	}

	option = {
		name = envoy_events.15.A
		
		every_country = {
			limit = {
				is_country_type = default
				OR = {
					has_country_flag = human_1
					has_country_flag = human_2
					is_xenophile = yes
				}
				is_galactic_community_member = yes
			}
			add_opinion_modifier = {
				who = root
				modifier = opinion_feline_affection
			}
		}
	}
}


#Ideological Disputes in the Federation
country_event = {
	id = envoy_events.16
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		any_envoy = {
			has_envoy_task = {
				task = federation
			}
		}
		federation = {
			any_member = {
				is_gestalt = no
				opposing_ethics_divergence = {
					steps >= 3
					who = root
				}
				any_envoy = {
					has_envoy_task = {
						task = federation
					}
				}
			}
		}
	}

	immediate = {
		save_event_target_as = dispute_member_1
		federation = {
			random_member = {
				limit = {
					is_gestalt = no
					opposing_ethics_divergence = {
						steps = 3
						who = root
					}
					any_envoy = {
						has_envoy_task = {
							task = federation
						}
					}
				}
				save_event_target_as = dispute_member_2
			}
		}
		random_list = {
			1 = {
				save_event_target_as = dispute_winner
				random_envoy = {
					limit = {
						has_envoy_task = {
							task = federation
						}
					}
					save_event_target_as = dispute_winner_envoy
				}
				event_target:dispute_member_2 = {
					save_event_target_as = dispute_loser
					random_envoy = {
						limit = {
							has_envoy_task = {
								task = federation
							}
						}
						save_event_target_as = dispute_loser_envoy
					}
					country_event = { id = envoy_events.17 }
				}

				modifier = {
					factor = 0.75
					event_target:dispute_member_2 = { is_federation_leader = yes }
				}
				modifier = {
					factor = 0.25
					event_target:dispute_member_2 = { is_federation_leader = yes }
					federation = {
						has_federation_type = hegemony_federation
					}
				}
				modifier = {
					factor = 0.85
					federation = {
						count_member = {
							count >= 2
							limit = {
								opposing_ethics_divergence = {
									steps <= 1
									who = event_target:dispute_member_2
								}
							}
						}
					}
				}
				modifier = {
					factor = 0.75
					federation = {
						count_member = {
							count >= 3
							limit = {
								opposing_ethics_divergence = {
									steps <= 1
									who = event_target:dispute_member_2
								}
							}
						}
					}
				}
			}
			1 = {
				save_event_target_as = dispute_loser
				random_envoy = {
					limit = {
						has_envoy_task = {
							task = federation
						}
					}
					save_event_target_as = dispute_loser_envoy
				}
				event_target:dispute_member_2 = {
					save_event_target_as = dispute_winner
					random_envoy = {
						limit = {
							has_envoy_task = {
								task = federation
							}
						}
						save_event_target_as = dispute_winner_envoy
					}
				}
				country_event = { id = envoy_events.17 }

				modifier = {
					factor = 0.75
					is_federation_leader = yes
				}
				modifier = {
					factor = 0.25
					is_federation_leader = yes
					federation = {
						has_federation_type = hegemony_federation
					}
				}
				modifier = {
					factor = 0.85
					federation = {
						count_member = {
							count >= 2
							limit = {
								opposing_ethics_divergence = {
									steps <= 1
									who = root
								}
							}
						}
					}
				}
				modifier = {
					factor = 0.75
					federation = {
						count_member = {
							count >= 3
							limit = {
								opposing_ethics_divergence = {
									steps <= 1
									who = root
								}
							}
						}
					}
				}
			}
		}
	}
}

country_event = {
	id = envoy_events.17
	title = envoy_events.17.name
	desc = {
		text = envoy_events.17.desc.militarist
		trigger = {
			is_militarist = yes
			event_target:dispute_winner = {
				is_pacifist = yes
			}
		}
	}
	desc = {
		text = envoy_events.17.desc.pacifist
		trigger = {
			is_pacifist = yes
			event_target:dispute_winner = {
				is_militarist = yes
			}
		}
	}
	desc = {
		text = envoy_events.17.desc.spiritualist
		trigger = {
			is_spiritualist = yes
			event_target:dispute_winner = {
				is_materialist = yes
			}
		}
	}
	desc = {
		text = envoy_events.17.desc.materialist
		trigger = {
			is_materialist = yes
			event_target:dispute_winner = {
				is_spiritualist = yes
			}
		}
	}
	desc = {
		text = envoy_events.17.desc.xenophile
		trigger = {
			is_xenophile = yes
			event_target:dispute_winner = {
				is_xenophobe = yes
			}
		}
	}
	desc = {
		text = envoy_events.17.desc.xenophobe
		trigger = {
			is_xenophobe = yes
			event_target:dispute_winner = {
				is_xenophile = yes
			}
		}
	}
	desc = {
		text = envoy_events.17.desc.egalitarian
		trigger = {
			is_egalitarian = yes
			event_target:dispute_winner = {
				is_authoritarian = yes
			}
		}
	}
	desc = {
		text = envoy_events.17.desc.authoritarian
		trigger = {
			is_authoritarian = yes
			event_target:dispute_winner = {
				is_egalitarian = yes
			}
		}
	}
	picture = GFX_evt_voting
	show_sound = event_assembly_fight

	is_triggered_only = yes

	option = {
		name = envoy_events.17.A
		tooltip = {
			federation = {
				add_cohesion = -25
			}
		}

		hidden_effect = {
			event_target:dispute_winner = {
				country_event = { id = envoy_events.18 }
			}
		}
	}
	option = {
		name = envoy_events.17.B
		
		federation = {
			add_cohesion = 25
		}

		if = {
			limit = {
				is_militarist = yes
				event_target:dispute_winner = {
					is_pacifist = yes
				}
			}
			add_modifier = {
				modifier = federation_militarist_ideology
				days = 5400
			}
		}
		else_if = {
			limit = {
				is_pacifist = yes
				event_target:dispute_winner = {
					is_militarist = yes
				}
			}
			add_modifier = {
				modifier = federation_pacifist_ideology
				days = 5400
			}
		}
		else_if = {
			limit = {
				is_spiritualist = yes
				event_target:dispute_winner = {
					is_materialist = yes
				}
			}
			add_modifier = {
				modifier = federation_materialist_ideology
				days = 5400
			}
		}
		else_if = {
			limit = {
				is_materialist = yes
				event_target:dispute_winner = {
					is_spiritualist = yes
				}
			}
			add_modifier = {
				modifier = federation_spiritualist_ideology
				days = 5400
			}
		}
		else_if = {
			limit = {
				is_xenophile = yes
				event_target:dispute_winner = {
					is_xenophobe = yes
				}
			}
			add_modifier = {
				modifier = federation_xenophobe_ideology
				days = 5400
			}
		}
		else_if = {
			limit = {
				is_xenophobe = yes
				event_target:dispute_winner = {
					is_xenophile = yes
				}
			}
			add_modifier = {
				modifier = federation_xenophile_ideology
				days = 5400
			}
		}
		else_if = {
			limit = {
				is_egalitarian = yes
				event_target:dispute_winner = {
					is_authoritarian = yes
				}
			}
			add_modifier = {
				modifier = federation_authoritarian_ideology
				days = 5400
			}
		}
		else_if = {
			limit = {
				is_authoritarian = yes
				event_target:dispute_winner = {
					is_egalitarian = yes
				}
			}
			add_modifier = {
				modifier = federation_egalitarian_ideology
				days = 5400
			}
		}

		hidden_effect = {
			event_target:dispute_winner = {
				country_event = { id = envoy_events.19 }
			}
		}
	}
	option = {
		name = {
			text = envoy_events.17.C1
			trigger = {
				is_gestalt = no
			}
		}
		name = {
			text = envoy_events.17.C2
			trigger = {
				is_hive_empire = yes
			}
		}
		name = {
			text = envoy_events.17.C3
			trigger = {
				is_machine_empire = yes
			}
		}
		event_target:dispute_loser_envoy = {
			unassign_leader = this
			set_cooldown = 1080
		}
	}
}

country_event = {
	id = envoy_events.18
	title = envoy_events.18.name
	desc = {
		text = envoy_events.18.desc.militarist
		trigger = {
			is_militarist = yes
			event_target:dispute_loser = {
				is_pacifist = yes
			}
		}
	}
	desc = {
		text = envoy_events.18.desc.pacifist
		trigger = {
			is_pacifist = yes
			event_target:dispute_loser = {
				is_militarist = yes
			}
		}
	}
	desc = {
		text = envoy_events.18.desc.spiritualist
		trigger = {
			is_spiritualist = yes
			event_target:dispute_loser = {
				is_materialist = yes
			}
		}
	}
	desc = {
		text = envoy_events.18.desc.materialist
		trigger = {
			is_materialist = yes
			event_target:dispute_loser = {
				is_spiritualist = yes
			}
		}
	}
	desc = {
		text = envoy_events.18.desc.xenophile
		trigger = {
			is_xenophile = yes
			event_target:dispute_loser = {
				is_xenophobe = yes
			}
		}
	}
	desc = {
		text = envoy_events.18.desc.xenophobe
		trigger = {
			is_xenophobe = yes
			event_target:dispute_loser = {
				is_xenophile = yes
			}
		}
	}
	desc = {
		text = envoy_events.18.desc.egalitarian
		trigger = {
			is_egalitarian = yes
			event_target:dispute_loser = {
				is_authoritarian = yes
			}
		}
	}
	desc = {
		text = envoy_events.18.desc.authoritarian
		trigger = {
			is_authoritarian = yes
			event_target:dispute_loser = {
				is_egalitarian = yes
			}
		}
	}
	picture = GFX_evt_voting
	show_sound = event_assembly_fight

	is_triggered_only = yes

	option = {
		name = envoy_events.18.A
		from = {
			add_opinion_modifier = {
				who = root
				modifier = opinion_ideological_dispute
			}
		}
		federation = {
			add_cohesion = -30
		}
	}
}

country_event = {
	id = envoy_events.19
	title = envoy_events.19.name
	desc = {
		text = envoy_events.19.desc.militarist
		trigger = {
			is_militarist = yes
			event_target:dispute_loser = {
				is_pacifist = yes
			}
		}
	}
	desc = {
		text = envoy_events.19.desc.pacifist
		trigger = {
			is_pacifist = yes
			event_target:dispute_loser = {
				is_militarist = yes
			}
		}
	}
	desc = {
		text = envoy_events.19.desc.spiritualist
		trigger = {
			is_spiritualist = yes
			event_target:dispute_loser = {
				is_materialist = yes
			}
		}
	}
	desc = {
		text = envoy_events.19.desc.materialist
		trigger = {
			is_materialist = yes
			event_target:dispute_loser = {
				is_spiritualist = yes
			}
		}
	}
	desc = {
		text = envoy_events.19.desc.xenophile
		trigger = {
			is_xenophile = yes
			event_target:dispute_loser = {
				is_xenophobe = yes
			}
		}
	}
	desc = {
		text = envoy_events.19.desc.xenophobe
		trigger = {
			is_xenophobe = yes
			event_target:dispute_loser = {
				is_xenophile = yes
			}
		}
	}
	desc = {
		text = envoy_events.19.desc.egalitarian
		trigger = {
			is_egalitarian = yes
			event_target:dispute_loser = {
				is_authoritarian = yes
			}
		}
	}
	desc = {
		text = envoy_events.19.desc.authoritarian
		trigger = {
			is_authoritarian = yes
			event_target:dispute_loser = {
				is_egalitarian = yes
			}
		}
	}
	picture = GFX_evt_voting
	show_sound = event_assembly_fight

	is_triggered_only = yes

	option = {
		name = envoy_events.19.A
		
		add_resource = {
			influence = 25
		}

		tooltip = {
			from = {
				if = {
					limit = {
						is_militarist = yes
						event_target:dispute_winner = {
							is_pacifist = yes
						}
					}
					add_modifier = {
						modifier = federation_militarist_ideology
						days = 5400
					}
				}
				else_if = {
					limit = {
						is_pacifist = yes
						event_target:dispute_winner = {
							is_militarist = yes
						}
					}
					add_modifier = {
						modifier = federation_pacifist_ideology
						days = 5400
					}
				}
				else_if = {
					limit = {
						is_spiritualist = yes
						event_target:dispute_winner = {
							is_materialist = yes
						}
					}
					add_modifier = {
						modifier = federation_materialist_ideology
						days = 5400
					}
				}
				else_if = {
					limit = {
						is_materialist = yes
						event_target:dispute_winner = {
							is_spiritualist = yes
						}
					}
					add_modifier = {
						modifier = federation_spiritualist_ideology
						days = 5400
					}
				}
				else_if = {
					limit = {
						is_xenophile = yes
						event_target:dispute_winner = {
							is_xenophobe = yes
						}
					}
					add_modifier = {
						modifier = federation_xenophobe_ideology
						days = 5400
					}
				}
				else_if = {
					limit = {
						is_xenophobe = yes
						event_target:dispute_winner = {
							is_xenophile = yes
						}
					}
					add_modifier = {
						modifier = federation_xenophile_ideology
						days = 5400
					}
				}
				else_if = {
					limit = {
						is_egalitarian = yes
						event_target:dispute_winner = {
							is_authoritarian = yes
						}
					}
					add_modifier = {
						modifier = federation_authoritarian_ideology
						days = 5400
					}
				}
				else_if = {
					limit = {
						is_authoritarian = yes
						event_target:dispute_winner = {
							is_egalitarian = yes
						}
					}
					add_modifier = {
						modifier = federation_egalitarian_ideology
						days = 5400
					}
				}
			}
		}
	}
}