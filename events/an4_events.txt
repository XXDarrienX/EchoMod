################################
#
# Anniversary Events
#
# Written by Douglas Furen
#
###############################

namespace = drones

# Ancient Mining Drone Expansion Fleet - Recurring spawn and assign event
# Early to Mid-game - Unclaimed systems only
event = {
	id = drones.1001
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = event_target:drone_country
		event_target:drone_country = {
			check_variable = {
				which = expansion_fleets_sent_var
				value <= 5
			}
			NOT = {
				has_country_flag = mining_drone_expansion_ongoing
			}
		}
		any_system = {
			NOR = {
				exists = starbase
				is_star_class = sc_black_hole
				any_fleet_in_system = {
					exists = owner
					owner = {
						is_guardian_country = yes
					}
				}
			}
			any_system_planet = {
				NOR = {
					is_planet_class = pc_gas_giant
					is_star = yes
				}
			}
		}
	}

	immediate = {
		event_target:drone_country = {
			change_variable = {
				which = expansion_fleets_sent_var
				value = 1
			}
			set_country_flag = mining_drone_expansion_ongoing
		}
		random_system = {
			limit = {
				any_fleet_in_system = {
					exists = owner
					owner = {
						is_country_type = drone
					}
				}
			}
			save_event_target_as = drone_expansion_starting_system
			random_system_planet = {
				limit = {
					is_star = no
				}
				save_event_target_as = drone_expansion_starting_planet
			}		
		}
		random_system = {
			limit = {
				NOR = {
					exists = starbase
					is_star_class = sc_black_hole
					any_fleet_in_system = {
						exists = owner
						owner = {
							is_guardian_country = yes
						}
					}
				}
				any_system_planet = {
					NOR = {
						is_planet_class = pc_gas_giant
						is_star = yes
					}
				}
			}
			save_event_target_as = drone_expansion_destination_system
		}
		event_target:drone_expansion_starting_system = {
			create_country = {
				name = "NAME_Mining_Drone_Expansion_Initiative"
				type = faction
				flag = {
					icon = {
						category = "legion"
						file = "flag_mp_beta_04.dds"
					}
					background = {
						category = "backgrounds"
						file = "00_solid.dds"
					}
					colors = {
						"black"
						"black"
						"null"
						"null"
					}
				}
				effect = {
					set_faction_hostility = {
						set_hostile = no
						set_neutral = yes
						set_friendly = no
					}
		if = { limit = { years_passed > 9 NOT = { has_modifier = basic_buff_1 } } add_modifier = { modifier = basic_buff_1 days = -1 } }
		if = { limit = { years_passed > 19 NOT = { has_modifier = basic_buff_2 } } add_modifier = { modifier = basic_buff_2 days = -1 } }
		if = { limit = { years_passed > 29 NOT = { has_modifier = basic_buff_3 } } add_modifier = { modifier = basic_buff_3 days = -1 } }
		if = { limit = { years_passed > 39 NOT = { has_modifier = basic_buff_4 } } add_modifier = { modifier = basic_buff_4 days = -1 } }
		if = { limit = { years_passed > 49 NOT = { has_modifier = basic_buff_5 } } add_modifier = { modifier = basic_buff_5 days = -1 } }
        if = { limit = { years_passed > 59 NOT = { has_modifier = basic_buff_6 } } add_modifier = { modifier = basic_buff_6 days = -1 } }							
					save_global_event_target_as = drone_expansion_country
					set_country_flag = drone_country
					every_country = {
						limit = {
							has_communications = event_target:drone_country
						}
						establish_communications_no_message = event_target:drone_expansion_country
					}
				}
			}
			last_created_country = {
				create_fleet = {
					name = "NAME_Mining_Drone_Expansion_Fleet"
					effect = {
						set_owner = event_target:drone_expansion_country
						set_fleet_stance = passive
						create_ship = {
							name = ""
							design = "NAME_Ancient_Mining_Expansion_Barge"
						}
						if = { limit = {years_passed = 10}
						  while = {
							count = 6
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Expansion_Drone"
							}
						  }
						}
						else_if = { limit = {years_passed = 20}
						  while = {
							count = 8
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Expansion_Drone"
							}
						  }
						}	
						else_if = { limit = {years_passed = 30}
						  while = {
							count = 10
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Expansion_Drone"
							}
						  }
						}	
						else_if = { limit = {years_passed = 40}
						  while = {
							count = 9
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Expansion_Drone_Tier2"
							}
						  }
						}	
						else_if = { limit = {years_passed = 50}
						  while = {
							count = 12
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Expansion_Drone_Tier2"
							}
						  }
						}	
						else_if = { limit = {years_passed = 60}
						  while = {
							count = 15
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Expansion_Drone_Tier2"
							}
						  }
						}						
						set_location = {
							target = event_target:drone_expansion_starting_planet
							distance = 25
							angle = random
						}
						save_event_target_as = drone_expansion_fleet
						queue_actions = {
							wait = {
								duration = 20
								random = 10
							}
							move_to = event_target:drone_expansion_destination_system
							effect = {
								id = "drones.1001.effect.1"
								event_target:drone_expansion_country = {
									country_event = { id = drones.1002 }
								}
							}
						}	
					}
				}
			}
		}
	}
}

# Ancient Mining Drone Expansion Fleet - Fleet erase, and base creation event
country_event = {
	id = drones.1002
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		create_drone_country = yes
		event_target:drone_expansion_destination_system	= {
			random_system_planet = {
				limit = {
					is_star = no
				}
				save_event_target_as = base_of_operations
			}
			if = {
				limit = {
					NOT = { exists = starbase }
				}
				create_fleet = {
					name = "NAME_Mining_Corps"
					effect = {
						set_owner = event_target:drone_country
						if = { limit = {years_passed < 19}
						  while = {
							count = 9
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Drone"
							}
						  }
						}
						else_if = { limit = {years_passed < 29}
						while = {
							count = 3
							create_ship = {
								name = ""
								design = "NAME_Ancient_Combat_Drone"
							}
						}						
						  while = {
							count = 6
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Drone"
							}
						  }
						}	
						else_if = { limit = {years_passed < 39}
						while = {
							count = 5
							create_ship = {
								name = ""
								design = "NAME_Ancient_Combat_Drone"
							}
						}						
						  while = {
							count = 8
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Drone"
							}
						  }
						}	
						else_if = { limit = {years_passed < 49}
						while = {
							count = 2
							create_ship = {
								name = ""
								design = "NAME_Ancient_Destroyer"
							}
						}						
						while = {
							count = 4
							create_ship = {
								name = ""
								design = "NAME_Ancient_Combat_Drone"
							}
						}						
						  while = {
							count = 8
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Drone"
							}
						  }
						}	
						else_if = { limit = {years_passed < 59}
						while = {
							count = 3
							create_ship = {
								name = ""
								design = "NAME_Ancient_Destroyer"
							}
						}						
						while = {
							count = 6
							create_ship = {
								name = ""
								design = "NAME_Ancient_Combat_Drone"
							}
						}						
						  while = {
							count = 10
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Drone"
							}
						  }
						}	
						else_if = { limit = {years_passed > 58}
						while = {
							count = 2
							create_ship = {
								name = ""
								design = "NAME_Ancient_Destroyer_Tier2"
							}
						}						
						while = {
							count = 5
							create_ship = {
								name = ""
								design = "NAME_Ancient_Combat_Drone_Tier2"
							}
						}						
						  while = {
							count = 9
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Drone_Tier2"
							}
						  }
						}						
						set_location = {
							target = event_target:base_of_operations
							distance = 20
							angle = 20
						}
						set_formation_scale = 2
						set_fleet_stance = aggressive
						set_aggro_range_measure_from = return_point
						set_aggro_range = 200
					}
				}
				solar_system = {
				    set_star_flag = hostile_system				
				    if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_1 } } } set_star_flag = drone_exp_1 }
				    else_if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_2 } } } set_star_flag = drone_exp_2 }
				    else_if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_3 } } } set_star_flag = drone_exp_3 }
				    else_if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_4 } } } set_star_flag = drone_exp_4 }
				    else_if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_5 } } } set_star_flag = drone_exp_5 }
				    else_if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_6 } } } set_star_flag = drone_exp_6 }
				    else_if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_7 } } } set_star_flag = drone_exp_7 }
				    else_if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_8 } } } set_star_flag = drone_exp_8 }
				    else_if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_9 } } } set_star_flag = drone_exp_9 }
				    else_if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_10 } } } set_star_flag = drone_exp_10 }					
					random_system_planet = {
						limit = {
							NOR = {
								is_planet_class = pc_gas_giant
								is_star = yes
							}
						}
						create_mining_station = {
							owner = event_target:drone_country
						}
					}
					random_fleet_in_system = {
						limit = {
							exists = owner
							owner = {
								is_same_value = root
							}
						}
						destroy_fleet = this
					}
				}
				event_target:drone_country = {
					remove_country_flag = mining_drone_expansion_ongoing
				}
				root = {
					destroy_country = yes
				}
			}
			else = {
				random_system = {
					limit = {
						NOR = {
							exists = starbase
							is_star_class = sc_black_hole
							any_fleet_in_system = {
							    exists = owner
								owner = {
									is_guardian_country = yes
								}
							}
						}
						any_system_planet = {
							NOR = {
								is_planet_class = pc_gas_giant
								is_star = yes
							}
						}
					}
					save_event_target_as = drone_expansion_destination_system
				}
				event_target:drone_expansion_fleet = {
					queue_actions = {
						wait = {
							duration = 20
							random = 10
						}
						move_to = event_target:drone_expansion_destination_system
						effect = {
							id = "drones.1002.effect.1"
							event_target:drone_expansion_country = {
								country_event = { id = drones.1002 }
							}
						}
					}	
				}
			}
		}
	}
}

# Ancient Mining Drone Expansion Fleet - Recurring spawn and assign event
# Mid-game to End-game - May go into claimed systems
event = {
	id = drones.1003
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		mid_game_years_passed > 1
		exists = event_target:drone_country
		event_target:drone_country = {
			check_variable = { 
				which = aggressive_expansion_fleets_sent_var
				value <= 10
			}
			NOT = {
				has_country_flag = mining_drone_expansion_ongoing
			}
  		}
  		any_system = {
  			OR = {
				NOT = { exists = space_owner }
				AND = {
					exists = space_owner
					space_owner = {
						NOT = { is_country_type = fallen_empire }
					}
				}
			}
			NOR = {
				is_star_class = sc_black_hole
				any_fleet_in_system = {
					exists = owner
					owner = {
						is_guardian_country = yes
					}
				}
			}
			any_system_planet = {
				NOR = {
					is_planet_class = pc_gas_giant
					is_star = yes
				}
			}
		}
	}

	immediate = {
		event_target:drone_country = {
			change_variable = {
				which = aggressive_expansion_fleets_sent_var
				value = 1
			}
			set_country_flag = mining_drone_expansion_ongoing
		}
		random_system = {
			limit = {
				any_fleet_in_system = {
					exists = owner
					owner = {
						is_country_type = drone
					}
				}
			}
			save_event_target_as = aggressive_drone_expansion_starting_system
			random_system_planet = {
				limit = {
					is_star = no
				}
				save_event_target_as = aggressive_drone_expansion_starting_planet
			}		
		}
		random_system = {
			limit = {
  				OR = {
					NOT = { exists = space_owner }
					AND = {
						exists = space_owner
						space_owner = {
							NOT = { is_country_type = fallen_empire }
						}
					}
				}
				NOR = {
					is_star_class = sc_black_hole
					any_fleet_in_system = {
						exists = owner
						owner = {
							is_guardian_country = yes
						}
					}
				}
				any_system_planet = {
					NOR = {
						is_planet_class = pc_gas_giant
						is_star = yes
					}
				}
			}
			save_event_target_as = aggressive_drone_expansion_destination_system
		}
		event_target:aggressive_drone_expansion_starting_system = {
			create_country = {
				name = "NAME_Aggressive_Mining_Drone_Expansion_Initiative"
				type = faction
				flag = {
					icon = {
						category = "legion"
						file = "flag_mp_beta_05.dds"
					}
					background = {
						category = "backgrounds"
						file = "00_solid.dds"
					}
					colors = {
						"black"
						"black"
						"null"
						"null"
					}
				}
				effect = {
		if = { limit = { NOT = { has_modifier = basic_buff_1 } } add_modifier = { modifier = basic_buff_1 days = -1 } }
		if = { limit = { NOT = { has_modifier = basic_buff_2 } } add_modifier = { modifier = basic_buff_2 days = -1 } }
		if = { limit = { years_passed > 29 NOT = { has_modifier = basic_buff_3 } } add_modifier = { modifier = basic_buff_3 days = -1 } }
		if = { limit = { years_passed > 39 NOT = { has_modifier = basic_buff_4 } } add_modifier = { modifier = basic_buff_4 days = -1 } }
		if = { limit = { years_passed > 49 NOT = { has_modifier = basic_buff_5 } } add_modifier = { modifier = basic_buff_5 days = -1 } }
        if = { limit = { years_passed > 59 NOT = { has_modifier = basic_buff_6 } } add_modifier = { modifier = basic_buff_6 days = -1 } }		
		if = { limit = { years_passed > 79 NOT = { has_modifier = basic_buff_7 } } add_modifier = { modifier = basic_buff_7 days = -1 } }
		if = { limit = { years_passed > 99 NOT = { has_modifier = basic_buff_8 } } add_modifier = { modifier = basic_buff_8 days = -1 } }
		if = { limit = { years_passed > 119 NOT = { has_modifier = basic_buff_9 } } add_modifier = { modifier = basic_buff_9 days = -1 } }
        if = { limit = { years_passed > 149 NOT = { has_modifier = basic_buff_10 } } add_modifier = { modifier = basic_buff_10 days = -1 } }	
		if = { limit = { years_passed > 29 NOT = { has_modifier = for_solo_buff_1 } } add_modifier = { modifier = for_solo_buff_1 days = -1 } }	
		if = { limit = { years_passed > 59 NOT = { has_modifier = for_solo_buff_2 } } add_modifier = { modifier = for_solo_buff_2 days = -1 } }		
		if = { limit = { years_passed > 89 NOT = { has_modifier = for_solo_buff_3 } } add_modifier = { modifier = for_solo_buff_3 days = -1 } }	
		if = { limit = { years_passed > 119 NOT = { has_modifier = for_solo_buff_4 } } add_modifier = { modifier = for_solo_buff_4 days = -1 } }	
		if = { limit = { years_passed > 149 NOT = { has_modifier = for_solo_buff_5 } } add_modifier = { modifier = for_solo_buff_5 days = -1 } }		
					set_faction_hostility = {
						set_hostile = no
						set_neutral = yes
						set_friendly = no
					}
					set_country_flag = drone_country
					save_global_event_target_as = aggressive_drone_expansion_country
					every_country = {
						limit = {
							has_communications = event_target:drone_country
						}
						establish_communications_no_message = event_target:drone_expansion_country
					}
				}
			}
			last_created_country = {
				create_fleet = {
					name = "NAME_Aggressive_Mining_Drone_Expansion_Fleet"
					effect = {
						set_owner = event_target:aggressive_drone_expansion_country
						set_fleet_stance = passive
						create_ship = {
							name = ""
							design = "NAME_Ancient_Mining_Expansion_Barge"
						}
						if = { limit = {years_passed < 30}
						  while = {
							count = 10
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Expansion_Drone"
							}
						  }
						}
						else_if = { limit = {years_passed < 60}
						  while = {
							count = 13
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Expansion_Drone"
							}
						  }
						}	
						else_if = { limit = {years_passed < 90}
						  while = {
							count = 17
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Expansion_Drone"
							}
						  }
						}	
						else_if = { limit = {years_passed < 110}
						  while = {
							count = 16
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Expansion_Drone_Tier2"
							}
						  }
						}	
						else_if = { limit = {years_passed < 130}
						  while = {
							count = 20
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Expansion_Drone_Tier2"
							}
						  }
						}	
						else_if = { limit = {years_passed > 129}
						  while = {
							count = 25
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Expansion_Drone_Tier2"
							}
						  }
						}
						set_location = {
							target = event_target:aggressive_drone_expansion_starting_planet
							distance = 25
							angle = random
						}
						save_event_target_as = aggressive_drone_expansion_fleet
						queue_actions = {
							wait = {
								duration = 20
								random = 10
							}
							move_to = event_target:aggressive_drone_expansion_destination_system
							effect = {
								id = "drones.1003.effect.1"
								event_target:aggressive_drone_expansion_country = {
									country_event = { id = drones.1004 }
								}
							}
						}	
					}
				}
			}
		}
	}
}

# Ancient Mining Drone Expansion Fleet - Fleet erase, and base creation event
country_event = {
	id = drones.1004
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		create_drone_country = yes
		event_target:aggressive_drone_expansion_destination_system	= {
			random_system_planet = {
				limit = {
					is_star = no
				}
				save_event_target_as = aggressive_base_of_operations
			}
			random_system_planet = {
				limit = {
					is_star = no
					NOT = { is_same_value = event_target:aggressive_base_of_operations }
				}
				save_event_target_as = aggressive_base_of_operations2
			}			
			if = {
				limit = {
					NOT = { exists = starbase }
				}
				create_fleet = {
					name = "NAME_Mining_Corps"
					effect = {
						set_owner = event_target:drone_country
						if = { limit = { years_passed < 50 }
						while = {
							count = 10
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Drone"
							}
						}
						while = {
							count = 8
							create_ship = {
								name = ""
								design = "NAME_Ancient_Combat_Drone"
							}
						}
						while = {
							count = 6
							create_ship = {
								name = ""
								design = "NAME_Ancient_Destroyer"
							}
						}
						}
						else_if = { limit = { years_passed > 49 }
						while = {
							count = 14
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Drone"
							}
						}
						while = {
							count = 11
							create_ship = {
								name = ""
								design = "NAME_Ancient_Combat_Drone"
							}
						}
						while = {
							count = 8
							create_ship = {
								name = ""
								design = "NAME_Ancient_Destroyer"
							}
						}
						}						
						set_location = {
							target = event_target:aggressive_base_of_operations
							distance = 20
							angle = 20
						}
						set_formation_scale = 3
						set_fleet_stance = aggressive
						set_aggro_range_measure_from = return_point
						set_aggro_range = 400
					}
				}
				if = { limit = {years_passed > 39 exists = event_target:aggressive_base_of_operations2 }
				  create_fleet = {
					name = "NAME_Mining_Corps"
					effect = {
						set_owner = event_target:drone_country
						if = { limit = { years_passed < 70 }
						while = {
							count = 12
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Drone_Tier2"
							}
						}
						while = {
							count = 7
							create_ship = {
								name = ""
								design = "NAME_Ancient_Combat_Drone_Tier2"
							}
						}
						while = {
							count = 5
							create_ship = {
								name = ""
								design = "NAME_Ancient_Destroyer_Tier2"
							}
						}
						}
						else_if = { limit = { years_passed > 69 }
						while = {
							count = 13
							create_ship = {
								name = ""
								design = "NAME_Ancient_Mining_Drone_Tier2"
							}
						}
						while = {
							count = 9
							create_ship = {
								name = ""
								design = "NAME_Ancient_Combat_Drone_Tier2"
							}
						}
						while = {
							count = 7
							create_ship = {
								name = ""
								design = "NAME_Ancient_Destroyer_Tier2"
							}
						}
						}						
						set_location = {
							target = event_target:aggressive_base_of_operations2
							distance = 20
							angle = 20
						}
						set_formation_scale = 3
						set_fleet_stance = aggressive
						set_aggro_range_measure_from = return_point
						set_aggro_range = 400
					}
				  }				
				}
				solar_system = {
				    set_star_flag = hostile_system
				    if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_1 } } } set_star_flag = drone_exp_1 }
				    else_if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_2 } } } set_star_flag = drone_exp_2 }
				    else_if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_3 } } } set_star_flag = drone_exp_3 }
				    else_if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_4 } } } set_star_flag = drone_exp_4 }
				    else_if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_5 } } } set_star_flag = drone_exp_5 }
				    else_if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_6 } } } set_star_flag = drone_exp_6 }
				    else_if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_7 } } } set_star_flag = drone_exp_7 }
				    else_if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_8 } } } set_star_flag = drone_exp_8 }
				    else_if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_9 } } } set_star_flag = drone_exp_9 }
				    else_if = { limit = { NOT = { any_system = {has_star_flag = drone_exp_10 } } } set_star_flag = drone_exp_10 }					
					random_system_planet = {
						limit = {
							NOR = {
								is_planet_class = pc_gas_giant
								is_star = yes
							}
						}
						create_mining_station = {
							owner = event_target:drone_country
						}
					}
					random_system_planet = {
						limit = {
							NOR = {
								is_planet_class = pc_gas_giant
								is_star = yes
							}
						}
						create_mining_station = {
							owner = event_target:drone_country
						}
					}
					random_system_planet = {
						limit = {
							NOR = {
								is_planet_class = pc_gas_giant
								is_star = yes
							}
						}
						create_mining_station = {
							owner = event_target:drone_country
						}
					}
					random_fleet_in_system = {
						limit = {
							exists = owner
							owner = {
								is_same_value = root
							}
						}
						destroy_fleet = this
					}
				}
				event_target:drone_country = {
					remove_country_flag = mining_drone_expansion_ongoing
				}
				root = {
					destroy_country = yes
				}
			}
			else = {
				random_system = {
					limit = {
  						OR = {
							NOT = { exists = space_owner }
							AND = {
								exists = space_owner
								space_owner = {
									NOT = { is_country_type = fallen_empire }
								}
							}
						}
						NOR = {
							is_star_class = sc_black_hole
							any_fleet_in_system = {
								exists = owner
								owner = {
									is_guardian_country = yes
								}
							}
						}
						any_system_planet = {
							NOR = {
								is_planet_class = pc_gas_giant
								is_star = yes
							}
						}
					}
					save_event_target_as = aggressive_drone_expansion_destination_system
				}
				event_target:aggressive_drone_expansion_fleet = {
					queue_actions = {
						wait = {
							duration = 20
							random = 10
						}
						move_to = event_target:aggressive_drone_expansion_destination_system
						effect = {
							id = "drones.1004.effect.1"
							event_target:aggressive_drone_expansion_country = {
								country_event = { id = drones.1004 }
							}
						}
					}	
				}
			}
		}
	}
}

# Space Crystal Splitter Fleet - Recurring spawn and assign event
# Throughout the entire game
event = {
	id = drones.1010
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = event_target:crystal_country
		event_target:crystal_country = {
			check_variable = {
				which = splitter_fleets_sent_var
				value <= 20
			}
			NOT = {
				has_country_flag = space_crystal_expansion_ongoing
			}
		}
		any_system = {
			NOR = {
				is_star_class = sc_black_hole
				any_fleet_in_system = {
					exists = owner
					owner = {
						is_guardian_country = yes
					}
				}
			}
			any_system_planet = {
				is_asteroid = yes
			}
		}
	}

	immediate = {
		event_target:crystal_country = {
			change_variable = {
				which = splitter_fleets_sent_var
				value = 1
			}
			set_country_flag = space_crystal_expansion_ongoing
		}
		random_system = {
			limit = {
				any_fleet_in_system = {
					exists = owner
					owner = {
						is_country_type = crystal
					}
				}
			}
			save_event_target_as = crystal_splitter_starting_system
			random_system_planet = {
				limit = {
					is_star = no
				}
				save_event_target_as = crystal_splitter_starting_planet
			}		
		}
		random_system = {
			limit = {
				NOR = {
					is_star_class = sc_black_hole
					any_fleet_in_system = {
						exists = owner
						owner = {
							is_guardian_country = yes
						}
					}
				}
				any_system_planet = {
					is_asteroid = yes
				}
			}
			random_system_planet = {
				limit = {
					is_asteroid = yes
				}
				save_event_target_as = crystal_splitter_destination_planet
			}
			random_system_planet = {
				limit = {
					is_star = yes
				}
				save_event_target_as = crystal_splitter_destination_sun
			}
		}
		event_target:crystal_splitter_starting_system = {
			create_country = {
				name = "NAME_Cracked_Crystalline_Shard"
				type = faction
				flag = {
					icon = {
						category = "pointy"
						file = "flag_pointy_15.dds"
					}
					background = {
						category = "backgrounds"
						file = "00_solid.dds"
					}
					colors = {
						"black"
						"black"
						"null"
						"null"
					}
				}
				effect = {
					set_country_flag = crystal_country
					set_faction_hostility = {
						set_hostile = no
						set_neutral = yes
						set_friendly = no
					}
					every_country = {
						limit = {
							has_modifier = pacified_crystals
						}
						prev = {
							set_faction_hostility = {
								set_hostile = no
								set_neutral = yes
								target = prev
							}
						}
					}					
		if = { limit = { NOT = { has_modifier = basic_buff_1 } } add_modifier = { modifier = basic_buff_1 days = -1 } }
		if = { limit = { years_passed > 19 NOT = { has_modifier = basic_buff_2 } } add_modifier = { modifier = basic_buff_2 days = -1 } }
		if = { limit = { years_passed > 29 NOT = { has_modifier = basic_buff_3 } } add_modifier = { modifier = basic_buff_3 days = -1 } }
		if = { limit = { years_passed > 39 NOT = { has_modifier = basic_buff_4 } } add_modifier = { modifier = basic_buff_4 days = -1 } }
		if = { limit = { years_passed > 49 NOT = { has_modifier = basic_buff_5 } } add_modifier = { modifier = basic_buff_5 days = -1 } }
        if = { limit = { years_passed > 59 NOT = { has_modifier = basic_buff_6 } } add_modifier = { modifier = basic_buff_6 days = -1 } }		
		if = { limit = { years_passed > 79 NOT = { has_modifier = basic_buff_7 } } add_modifier = { modifier = basic_buff_7 days = -1 } }
		if = { limit = { years_passed > 99 NOT = { has_modifier = basic_buff_8 } } add_modifier = { modifier = basic_buff_8 days = -1 } }
		if = { limit = { years_passed > 119 NOT = { has_modifier = basic_buff_9 } } add_modifier = { modifier = basic_buff_9 days = -1 } }
        if = { limit = { years_passed > 149 NOT = { has_modifier = basic_buff_10 } } add_modifier = { modifier = basic_buff_10 days = -1 } }	
		if = { limit = { years_passed > 29 NOT = { has_modifier = for_solo_buff_1 } } add_modifier = { modifier = for_solo_buff_1 days = -1 } }	
		if = { limit = { years_passed > 59 NOT = { has_modifier = for_solo_buff_2 } } add_modifier = { modifier = for_solo_buff_2 days = -1 } }		
		if = { limit = { years_passed > 89 NOT = { has_modifier = for_solo_buff_3 } } add_modifier = { modifier = for_solo_buff_3 days = -1 } }	
		if = { limit = { years_passed > 119 NOT = { has_modifier = for_solo_buff_4 } } add_modifier = { modifier = for_solo_buff_4 days = -1 } }	
		if = { limit = { years_passed > 149 NOT = { has_modifier = for_solo_buff_5 } } add_modifier = { modifier = for_solo_buff_5 days = -1 } }						
					save_global_event_target_as = crystal_splitter_country
					every_country = {
						limit = {
							has_communications = event_target:crystal_country
						}
						establish_communications_no_message = event_target:crystal_splitter_country
					}
				}
			}
			last_created_country = {
				create_fleet = {
					name = "NAME_Cracked_Crystalline_Shard"
					effect = {
						set_owner = event_target:crystal_splitter_country
						set_fleet_stance = passive
						create_ship = {
							name = ""
							design = "NAME_Cracked_Crystalline_Shard"
						}
						set_location = {
							target = event_target:crystal_splitter_starting_planet
							distance = 25
							angle = random
						}
						save_event_target_as = crystal_splitter_fleet
						queue_actions = {
							wait = {
								duration = 20
								random = 10
							}
							move_to = event_target:crystal_splitter_destination_planet
							effect = {
								id = "drones.1010.effect.1"
								event_target:crystal_splitter_country = {
									country_event = { id = drones.1011 }
								}
							}
						}	
					}
				}
			}
		}
	}
}

# Space Crystal Splitter Fleet - Fleet erase, and spawn of new fleet
country_event = {
	id = drones.1011
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		event_target:crystal_splitter_destination_planet = {
			create_fleet = {
				name = "NAME_Shardlings"
				effect = {
					set_owner = event_target:crystal_country
					add_modifier = { modifier = khan_buff_1 days = -1 }
		if = { limit = { years_passed > 24 } add_modifier = { modifier = for_solo_buff_1 days = -1 } }	
		if = { limit = { years_passed > 39 } add_modifier = { modifier = for_solo_buff_2 days = -1 } }		
		if = { limit = { years_passed > 54 } add_modifier = { modifier = for_solo_buff_3 days = -1 } }	
		if = { limit = { years_passed > 69 } add_modifier = { modifier = for_solo_buff_4 days = -1 } }	
		if = { limit = { years_passed > 84 } add_modifier = { modifier = for_solo_buff_5 days = -1 } }		
		if = { limit = { years_passed > 99 } add_modifier = { modifier = for_solo_buff_6 days = -1 } }			
					create_ship = {
						name = ""
						design = "NAME_Small_Crystal_Entity_Blue"
					}
					create_ship = {
						name = ""
						design = "NAME_Small_Crystal_Entity_Blue"
					}
					create_ship = {
						name = ""
						design = "NAME_Small_Crystal_Entity_Blue"
					}
					create_ship = {
						name = ""
						design = "NAME_Small_Crystal_Entity_Blue"
					}
					create_ship = {
						name = ""
						design = "NAME_Small_Crystal_Entity_Blue"
					}
					create_ship = {
						name = ""
						design = "NAME_Small_Crystal_Entity_Blue"
					}
					create_ship = {
						name = ""
						design = "NAME_Small_Crystal_Entity_Blue"
					}
					create_ship = {
						name = ""
						design = "NAME_Small_Crystal_Entity_Blue"
					}
					create_ship = {
						name = ""
						design = "NAME_Small_Crystal_Entity_Blue"
					}
					set_fleet_formation = {
						position = { x = 14.0	y = -3.0	} #9
						position = { x = 1.3	y = -11.0	} #8
						position = { x = -10.5	y = 1.0		} #7
						position = { x = 3.0	y = 8.0		} #6
						position = { x = -4.3	y = -7.0	} #5
						position = { x = 8.0	y = 9.0		} #4
						position = { x = -4.0	y = 7.3		} #3 
						position = { x = 7.5	y = -10.5	} #2
						position = { x = 0.0	y = 0.0		} #1
					}
					set_formation_scale = 0.5
					set_fleet_stance = aggressive
					set_aggro_range_measure_from = return_point
					set_aggro_range = 40
					set_location = {
						target = event_target:crystal_splitter_destination_planet
						distance = 20
						angle = 20
					}
					queue_actions = {
						wait = {
							duration = 20
							random = 10
						}
						move_to = event_target:crystal_splitter_destination_sun
					}
				}
			}
			
			event_target:crystal_splitter_destination_planet = {
				change_pc = pc_shattered
				solar_system = {
				    set_star_flag = cryst_exp_sys
					if = {
					    limit = {
						    NOR = {
							    has_star_flag = marauder_system
								has_star_flag = hostile_system
							}
						    OR = {
						        NOT = { exists = starbase }
								AND = {
								    exists = starbase
									OR = {
									    AND = {
										    years_passed < 50
                                            starbase = { has_starbase_size < starbase_starport }
										}									
									    AND = {
										    years_passed > 49
                                            starbase = { has_starbase_size < starbase_starhold }
										}
									}
                                    NOT = { 
									    any_system_planet = {
										    OR = {
											    is_capital = yes
											    is_colony = yes
												is_under_colonization = yes
											}
										} 
									}									
								}
							}
						}
						set_star_flag = hostile_system
					}
				}
			}
			root = {
				destroy_country = yes
			}
		}
	}

	after = {
		event_target:crystal_country = {
			remove_country_flag = space_crystal_expansion_ongoing
		}
	}
}
