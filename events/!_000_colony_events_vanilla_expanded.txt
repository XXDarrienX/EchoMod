############################
#
# Colony Events
#
# Written by Henrik Eklund
#
############################

namespace = colony

### Seismic Disturbances
planet_event = {
	id = colony.50
	title = "colony.50.name"
	desc = "colony.50.desc"
	picture = GFX_evt_in_the_dark
	show_sound = event_air_raid_siren
	location = ROOT
	trackable = yes
	
	trigger = {
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		owner = { is_ai = no }
		#owner = { NOT = { has_ethic = ethic_gestalt_consciousness } }
		has_ground_combat = no
		is_occupied_flag = no
		num_pops > 0
		is_capital = no
		NOR = {
			has_global_flag = seismic_disturbance_global
			has_planet_flag = colony_event
			is_planet_class = pc_nuked
			is_planet_class = pc_ringworld_habitable
			is_planet_class = pc_habitat
			is_planet_class = pc_city
			has_modifier = underground_world
		}
	}
	
	is_triggered_only = yes
	
	immediate = {
		owner = { save_event_target_as = subterranean_planet_owner }
		set_global_flag = seismic_disturbance_global
		set_planet_flag = seismic_disturbance
		set_planet_flag = colony_event
		add_deposit = d_underground_farm_blocked
		add_deposit = d_underground_mine_blocked
		add_deposit = d_underground_generator_blocked
	}
	
	option = {
		name = colony.50.a
		begin_event_chain = {
			event_chain = "subterranean_civilization_chain"
			target = ROOT
		}
		enable_special_project = {
			name = "SEISMIC_DISTURBANCE_1_PROJECT" #Establish Communications
			location = this
			owner = root
		}
		enable_special_project = {
			name = "SEISMIC_DISTURBANCE_2_PROJECT" #Preemptive Strike
			location = this
			owner = root
		}
		
	}
	option = {
		name = distar.216.a.exter
		exclusive_trigger = { owner = { is_homicidal = yes } }
		begin_event_chain = {
			event_chain = "subterranean_civilization_chain"
			target = ROOT
		}
		enable_special_project = {
			name = "SEISMIC_DISTURBANCE_2_PROJECT" #Preemptive Strike
			location = this
			owner = root
		}
		
	}
}

# Subterranean Invasion!
planet_event = {
	id = colony.54
	title = "colony.54.name"
	desc = "colony.54.desc"
	picture = GFX_evt_ground_combat
	show_sound = event_ground_battle
	location = ROOT
	
	is_triggered_only = yes
	
	immediate = {
		owner = { set_country_flag = subterranean_invasion_country }
		set_planet_flag = subterranean_invasion_planet
		event_target:subterranean_nation = {
			create_leader = {
				class = general
				species = owner_main_species
				name = random
				skill = 3
			}
		}
		if = {
			limit = {
				event_target:subterranean_nation = {
					NOT = { has_country_flag = tech_request_approved }
				}
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "industrial_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "industrial_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "industrial_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "industrial_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "industrial_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "industrial_army"
				leader = last_created_leader
			}
			if = {
				limit = {
					event_target:subterranean_nation = { has_country_flag = robot_request_approved }
				}
				create_army = {
					name = random
					owner = event_target:subterranean_nation
					species = none
					type = "robotic_army"
					leader = last_created_leader
				}
				create_army = {
					name = random
					owner = event_target:subterranean_nation
					species = none
					type = "robotic_army"
					leader = last_created_leader
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:subterranean_nation = { has_country_flag = tech_request_approved }
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "postatomic_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "postatomic_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "postatomic_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "postatomic_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "postatomic_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "postatomic_army"
				leader = last_created_leader
			}
			if = {
				limit = {
					event_target:subterranean_nation = { has_country_flag = robot_request_approved }
				}
				create_army = {
					name = random
					owner = event_target:subterranean_nation
					species = none
					type = "robotic_army"
					leader = last_created_leader
				}
				create_army = {
					name = random
					owner = event_target:subterranean_nation
					species = none
					type = "robotic_army"
					leader = last_created_leader
				}
			}
			break = yes
		}
	}		
	
	option = {
		name = colony.54.a
		custom_tooltip = subterranean_invasion
	}
}

# Another Invasion
planet_event = {
	id = colony.60
	title = "colony.54.name"
	desc = "colony.60.desc"
	picture = GFX_evt_ground_combat
	show_sound = event_ground_battle
	location = ROOT
	
	trigger = {
		has_planet_flag = seismic_disturbance_war
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		has_ground_combat = no
		num_pops > 0
	}
	
	mean_time_to_happen = {
		months = 240
	}
	
	immediate = {
		owner = { set_country_flag = subterranean_invasion_country }
		set_planet_flag = subterranean_invasion_planet
		random_country = {
			limit = {
				is_country_type = adversary
				has_country_flag = subterranean_nation
			}
			save_event_target_as = subterranean_nation
			owner_species = { save_event_target_as = subterranean_species }
			create_leader = {
				class = general
				species = event_target:subterranean_species
				name = random
				skill = 3
			}
		}
		if = {
			limit = {
				event_target:subterranean_nation = {
					NOT = { has_country_flag = tech_request_approved }
				}
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "industrial_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "industrial_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "industrial_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "industrial_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "industrial_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "industrial_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "industrial_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "industrial_army"
				leader = last_created_leader
			}
			if = {
				limit = {
					event_target:subterranean_nation = { has_country_flag = robot_request_approved }
				}
				create_army = {
					name = random
					owner = event_target:subterranean_nation
					species = none
					type = "robotic_army"
					leader = last_created_leader
				}
			}
			break = yes
		}
		if = {
			limit = {
				event_target:subterranean_nation = { has_country_flag = tech_request_approved }
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "postatomic_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "postatomic_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "postatomic_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "postatomic_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "postatomic_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "postatomic_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "postatomic_army"
				leader = last_created_leader
			}
			create_army = {
				name = "NAME_Invading_Horde"
				owner = event_target:subterranean_nation
				species = event_target:subterranean_species
				type = "postatomic_army"
				leader = last_created_leader
			}
			if = {
				limit = {
					event_target:subterranean_nation = { has_country_flag = robot_request_approved }
				}
				create_army = {
					name = random
					owner = event_target:subterranean_nation
					species = none
					type = "robotic_army"
					leader = last_created_leader
				}
			}
			break = yes
		}
	}		
	
	option = {
		name = colony.60.a
		custom_tooltip = subterranean_invasion_2
	}
}

# Collapse
planet_event = {
	id = colony.61
	title = "colony.61.name"
	desc = "colony.61.desc"
	picture = GFX_evt_underground_civilization
	show_sound = event_structural_collapse
	location = ROOT
	
	trigger = {
		has_planet_flag = seismic_disturbance_war
		NOT = { has_planet_flag = seismic_disturbance_collapse }
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		has_ground_combat = no
		has_army = yes
		num_pops > 0
	}
	
	mean_time_to_happen = {
		months = 240
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = seismic_disturbance_collapse
			days = 7200
		}
	}		
	
	option = {
		name = colony.61.a
		add_deposit = d_sinkhole_subterraneans
		random_planet_army = { remove_army = yes }
	}
}

# Raiding Parties
planet_event = {
	id = colony.62
	title = "colony.62.name"
	desc = "colony.62.desc"
	picture = GFX_evt_burning_settlement
	show_sound = event_ground_battle
	location = ROOT
	
	trigger = {
		has_planet_flag = seismic_disturbance_war
		NOT = { has_planet_flag = seismic_disturbance_raid }
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		has_ground_combat = no
		num_pops > 0
	}
	
	mean_time_to_happen = {
		months = 240
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = seismic_disturbance_raid
			days = 7200
		}
		add_planet_devastation = 10
	}		
	
	option = {
		name = colony.62.a
		tooltip = {
			add_planet_devastation = 10
		}
	}
}

# Surface Attack
planet_event = {
	id = colony.63
	title = "colony.63.name"
	desc = "colony.63.desc"
	picture = GFX_evt_burning_settlement
	show_sound = event_ground_battle
	location = ROOT
	
	trigger = {
		has_planet_flag = seismic_disturbance_war
		NOT = { has_planet_flag = seismic_disturbance_attack }
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		has_ground_combat = no
		num_pops > 1
	}
	
	mean_time_to_happen = {
		months = 240
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = seismic_disturbance_attack
			days = 7200
		}
	}		
	
	option = {
		name = colony.63.a
		add_planet_devastation = 10
		random_owned_pop = { kill_pop = yes }
		add_deposit = d_sinkhole_subterraneans
	}
}

# Famine
planet_event = {
	id = colony.69
	title = "colony.69.name"
	desc = "colony.69.desc"
	picture = GFX_evt_alien_cavemen
	show_sound = event_primitive_civilization
	location = ROOT
	
	trigger = {
		has_planet_flag = seismic_disturbance_friendly
		NOT = { has_planet_flag = seismic_disturbance_famine }
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		has_ground_combat = no
		num_pops > 0
	}
	
	mean_time_to_happen = {
		months = 240
		modifier = {
			factor = 2
			owner = { has_country_flag = tech_request_approved }
		}
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = seismic_disturbance_famine
			days = 32400
		}
	}
	
	option = {
		name = colony.69.a
		allow = {
			owner = {
				resource_stockpile_compare = { resource = food value >= 50 }
			}
		}
		owner = {
			add_resource = { food = -50 }
		}
		hidden_effect = {
			change_variable = { 
				which = "angry_subterraneans" 
				value = -1 
			}
		}
		custom_tooltip = subterraneans_pleased
	}
	option = {
		name = colony.69.b
		hidden_effect = {
			change_variable = { 
				which = "angry_subterraneans" 
				value = 1 
			}
		}
		custom_tooltip = subterraneans_displeased
	}
}

# Gift
planet_event = {
	id = colony.70
	title = "colony.70.name"
	desc = "colony.70.desc"
	picture = GFX_evt_alien_cavemen
	show_sound = event_primitive_civilization
	location = ROOT
	
	trigger = {
		has_planet_flag = seismic_disturbance_friendly
		NOT = { has_planet_flag = seismic_disturbance_gift }
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		has_ground_combat = no
		num_pops > 0
		check_variable = { 
			which = "angry_subterraneans" 
			value < 1 
		}
	}
	
	mean_time_to_happen = {
		months = 240
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = seismic_disturbance_gift
			days = 18000
		}
	}
	
	option = {
		name = colony.70.a
		owner = {
			add_monthly_resource_mult = {
				resource = minerals
				value = @tier1materialreward
				min = @tier1materialmin
				max = @tier1materialmax
			}
		}
	}
}

# Xeno Anthropologists
planet_event = {
	id = colony.72
	title = "colony.72.name"
	desc = "colony.72.desc"
	picture = GFX_evt_underground_civilization
	show_sound = event_primitive_civilization
	location = ROOT
	
	trigger = {
		has_planet_flag = seismic_disturbance_friendly
		NOT = { has_planet_flag = seismic_disturbance_anthropologists }
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		has_ground_combat = no
		num_pops > 0
		check_variable = {
			which = "angry_subterraneans"
			value < 1
		}
	}
	
	mean_time_to_happen = {
		months = 240
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = seismic_disturbance_anthropologists
			days = 18000
		}
	}
	
	option = {
		name = EXCELLENT
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}
}

# Earthquakes 2
planet_event = {
	id = colony.73
	title = "colony.68.name"
	desc = "colony.73.desc"
	picture = GFX_evt_underground_civilization
	show_sound = event_air_raid_siren
	location = ROOT
	
	trigger = {
		has_planet_flag = seismic_disturbance_friendly
		NOT = { has_planet_flag = seismic_disturbance_quake2 }
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		has_ground_combat = no
		num_pops > 0
	}
	
	mean_time_to_happen = {
		months = 240
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = seismic_disturbance_quake2
			days = 21600
		}
		add_planet_devastation = 10
	}
	
	option = {
		name = colony.73.a
		tooltip = {
			add_planet_devastation = 10
		}
		every_owned_pop = {
			add_modifier = {
				modifier = "pop_angry_subterranean"
				days = 3600
			}
		}
	}
	option = {
		name = colony.73.b
		tooltip = {
			add_planet_devastation = 10
		}
		hidden_effect = {
			change_variable = {
				which = "angry_subterraneans"
				value = 1
			}
		}
		custom_tooltip = subterraneans_displeased
	}
}

### Abandoned Terraforming
# Unstable Weather
planet_event = {
	id = colony.102
	title = "colony.102.name"
	desc = "colony.102.desc"
	picture = GFX_evt_burning_settlement
	show_sound = event_air_raid_siren
	location = ROOT
	
	trigger = {
		has_planet_flag = did_not_terraform
		NOT = { has_planet_flag = terraforming_unstable_weather }
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		has_ground_combat = no
		num_pops > 0
	}
	
	mean_time_to_happen = {
		months = 240
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = terraforming_unstable_weather
			days = 19800
		}
		add_planet_devastation = 10
	}
	
	option = {
		name = UNFORTUNATE
		tooltip = {
			add_planet_devastation = 10
		}
	}
}

# Drought
planet_event = {
	id = colony.103
	title = "colony.103.name"
	desc = "colony.103.desc"
	picture = GFX_evt_colony_settlement
	show_sound = event_planetary_riot
	location = ROOT
	
	trigger = {
		has_planet_flag = did_not_terraform
		NOT = { has_planet_flag = terraforming_drought }
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		has_ground_combat = no
		num_pops > 0
	}
	
	mean_time_to_happen = {
		months = 240
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = terraforming_drought
			days = 19800
		}
	}
	
	option = {
		name = colony.103.a
		every_owned_pop = {
			add_modifier = {
				modifier = "pop_drought"
				days = 3600
			}
		}
	}
	option = {
		name = colony.103.b
		trigger = {
			count_pops = {
				limit = { is_robot_pop = no }
				count < 9
			}
			owner = { resource_stockpile_compare = { resource = energy value >= 150 } }
		}
		owner = {
			add_resource = { energy = -150 }
		}
	}
	option = {
		name = colony.103.b
		trigger = {
			AND = {
				count_pops = {
					limit = { is_robot_pop = no }
					count > 8
				}
				count_pops = {
					limit = { is_robot_pop = no }
					count < 17
				}
			}
			owner = { resource_stockpile_compare = { resource = energy value >= 375 } }
		}
		owner = {
			add_resource = { energy = -375 }
		}
	}
	option = {
		name = colony.103.b
		trigger = {
			count_pops = {
				limit = { is_robot_pop = no }
				count > 16
			}
			owner = { resource_stockpile_compare = { resource = energy value >= 650 } }
		}
		owner = {
			add_resource = { energy = -600 }
		}
	}
}

# Special Project Completed 4 (Ammonia)
planet_event = {
	id = colony.107
	title = "PROJECT_COMPLETE"
	desc = "colony.107.desc"
	picture = GFX_evt_dead_city
	show_sound = event_activating_unknown_technology
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = colony.107.a
		destroy_colony = yes
		# Compatibility with Planetary Diversity
		if = {
			limit = {
				NOT = { is_planetary_diversity_active = yes }
			}
			change_pc = pc_toxic
			add_modifier = {
				modifier = "ammonia_biosphere"
				days = -1
			}
			set_deposit = d_society_3
		}
		else = { change_pc = pc_ammonia }
		hidden_effect = {
			remove_modifier = "abandoned_terraforming"
			if = {
				limit = { guilli_active = yes }
				if = {									# -guilli
					limit = {
						NOT = {
							gpm_has_precursor_modifiers = yes
						}
					}
					reroll_planet_modifiers = yes		# -guilli
					gpm_remove_precursor_modifiers = yes 	# -guilli
				}
				if = {
					limit = { has_planet_flag = gpm_is_wondrous_planet }
					remove_planet_flag = gpm_is_wondrous_world
					remove_planet_flag = gpm_is_wondrous_world_colour
					remove_modifier = Planet_Wonder_Discovered
					set_name = color_default_white
				}
				if = {
					limit = { has_planet_flag = gpm_is_precursor_world }
					add_modifier = { modifier = terraforming_candidate_precursor days = -1 } 
					set_name = color_precursor_col
				}
			}
		}
	}
}

### Underground Vault
planet_event = {
	id = colony.150
	title = "colony.150.name"
	desc = "colony.150.desc"
	picture = GFX_evt_underground_civilization
	show_sound = event_mystic_reveal
	location = ROOT
	trackable = yes
	
	trigger = {
		NOT = { has_global_flag = underground_vault_global }
		NOT = { has_planet_flag = armageddon_nuked }
		OR = {
			is_planet_class = pc_nuked
			has_planet_flag = colonized_tomb_world
			has_modifier = recovered_tomb_world
		}
		NOR = {
			has_planet_flag = primitives_nuked_themselves
			solar_system = {
				any_system_planet = {
					is_capital = yes
				}
			}
		}
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		owner = {
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		has_ground_combat = no
		is_occupied_flag = no
		num_pops > 0
		is_capital = no
	}
	
	is_triggered_only = yes
	
	immediate = {
		set_planet_flag = underground_vault_planet
		set_global_flag = underground_vault_global
	}
	
	option = {
		name = colony.150.a
		enable_special_project = {
			name = "UNDERGROUND_VAULT_PROJECT"
			location = this
			owner = root
		}
	}
	option = {
		name = colony.150.b
	}
}


# Nuclear Bomb
planet_event = {
	id = colony.155
	title = "colony.155.name"
	desc = "colony.155.desc"
	picture = GFX_evt_colony_settlement
	show_sound = event_air_raid_siren
	location = ROOT
	trackable = yes
	
	trigger = {
		NOT = { has_planet_flag = armageddon_nuked }
		OR = {
			is_planet_class = pc_nuked
			has_planet_flag = colonized_tomb_world
		}
		NOR = {
			has_planet_flag = wasteland_nuclear_bomb
			solar_system = {
				any_system_planet = {
					is_capital = yes
				}
			}
		}
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		has_ground_combat = no
		is_occupied_flag = no
		num_pops > 0
		is_capital = no
	}
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			set_planet_flag = wasteland_nuclear_bomb
		}
	}
	
	option = {
		name = colony.155.a
		enable_special_project = {
			name = "NUCLEAR_BOMB_PROJECT"
			location = this
			owner = root
		}
	}
}

# Particle Accelerator
planet_event = {
	id = colony.160
	title = "colony.160.name"
	desc = "colony.160.desc"
	picture = GFX_evt_physics_research
	show_sound = event_laboratory_sound
	location = ROOT
	
	trigger = {
		NOT = { has_planet_flag = armageddon_nuked }
		OR = {
			is_planet_class = pc_nuked
			has_modifier = recovered_tomb_world
		}
		NOR = {
			has_planet_flag = wasteland_particle_accelerator
			solar_system = {
				any_system_planet = {
					is_capital = yes
				}
			}
		}
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		has_ground_combat = no
		is_occupied_flag = no
		num_pops > 0
		is_capital = no
	}
	
	is_triggered_only = yes
	
	immediate = {
		set_planet_flag = wasteland_particle_accelerator
	}
	
	option = {
		name = FASCINATING
		add_deposit = d_ancient_particle_accelerator
	}
}

# Space Station
planet_event = {
	id = colony.162
	title = "colony.162.name"
	desc = "colony.162.desc"
	picture = GFX_evt_satellite_in_orbit
	show_sound = event_ship_bridge
	location = ROOT
	
	trigger = {
		NOT = { has_planet_flag = armageddon_nuked }
		OR = {
			is_planet_class = pc_nuked
			has_planet_flag = colonized_tomb_world
		}
		NOR = {
			has_planet_flag = wasteland_space_station
			has_planet_flag = primitives_nuked_themselves
			solar_system = {
				any_system_planet = {
					is_capital = yes
				}
			}
		}
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		has_ground_combat = no
		is_occupied_flag = no
		num_pops > 0
		is_capital = no
	}
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			set_planet_flag = wasteland_space_station
		}
	}
	
	option = {
		name = INTRIGUING
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
		}
	}
}

# Orbital Debris
planet_event = {
	id = colony.170
	title = "colony.170.name"
	desc = "colony.170.desc"
	picture = GFX_evt_satellite_in_orbit
	show_sound = event_ship_bridge
	location = ROOT
	trackable = yes
	
	trigger = {
		NOT = { has_planet_flag = armageddon_nuked }
		OR = {
			is_planet_class = pc_nuked
			has_planet_flag = colonized_tomb_world
		}
		NOR = {
			has_planet_flag = wasteland_orbital_debris
			has_planet_flag = primitives_nuked_themselves
			solar_system = {
				any_system_planet = {
					is_capital = yes
				}
			}
		}
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		has_ground_combat = no
		is_occupied_flag = no
		num_pops > 0
		is_capital = no
	}
	
	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			set_planet_flag = wasteland_orbital_debris
		}
	}
	
	option = {
		name = colony.170.a
		add_modifier = {
			modifier = "wasteland_orbital_debris"
			days = -1
		}
		enable_special_project = {
			name = "ORBITAL_DEBRIS_PROJECT"
			location = this
			owner = root
		}
	}
}

# Freighter Crash
planet_event = {
	id = colony.171
	title = "colony.171.name"
	desc = {
		trigger = { owner = { NOT = { has_authority = auth_machine_intelligence } } }
		text = colony.171.desc
	}
	desc = {
		trigger = { owner = { has_authority = auth_machine_intelligence } }
		text = colony.171.desc.mach
	}
	picture = GFX_evt_atmospheric_entry
	show_sound = event_ship_explosion
	location = ROOT
	
	trigger = {
		has_planet_flag = wasteland_orbital_debris
		has_modifier = wasteland_orbital_debris
		NOT = { has_planet_flag = wasteland_freighter_crash }
	}
	
	mean_time_to_happen = {
		months = 240
	}
	
	immediate = {
		set_timed_planet_flag = {
			flag = wasteland_freighter_crash
			days = 19800
		}
	}
	
	option = {
		name = colony.171.a
		add_deposit = d_crater
	}
}

# Debris Impact
planet_event = {
	id = colony.172
	title = "colony.172.name"
	desc = "colony.172.desc"
	picture = GFX_evt_atmospheric_entry
	show_sound = event_super_explosion
	location = ROOT
	
	trigger = {
		has_modifier = wasteland_orbital_debris
		has_planet_flag = wasteland_orbital_debris
		NOT = { has_planet_flag = wasteland_debris_impact }
	}
	
	mean_time_to_happen = {
		months = 240
	}
	
	immediate = {
		hidden_effect = {
			set_timed_planet_flag = {
				flag = wasteland_debris_impact
				days = 27000
			}
		}
	}
	
	option = {
		name = colony.172.a
		random_pop = {
			kill_pop = yes
		}
	}
}

### Asteroid Sighted
planet_event = {
	id = colony.180
	title = "colony.180.name"
	desc = "colony.180.desc"
	picture = GFX_evt_asteroid_approaching_planet
	show_sound = event_air_raid_siren
	location = ROOT
	
	trigger = {
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		owner = { is_ai = no }
		has_ground_combat = no
		is_occupied_flag = no
		num_pops > 0
		is_capital = no
		NOR = {
			is_planet_class = pc_habitat
			is_planet_class = pc_ringworld_habitable
			has_planet_flag = asteroid_sighted
			has_planet_flag = asteroid_collision
			has_global_flag = asteroid_sighted_global
			owner = { has_country_flag = asteroid_sighted_country }
		}
	}
	
	is_triggered_only = yes
	
	immediate = {
		owner = {
			set_country_flag = asteroid_sighted_country
		}
		set_global_flag = asteroid_sighted_global
		set_planet_flag = asteroid_sighted
		create_country = {
			name = "NAME_Incoming_Asteroid"
			type = faction
			auto_delete = no
			flag = {
				icon = {
					category = "zoological"
					file = "flag_zoological_1.dds"
				}
				background= {
					category = "backgrounds"
					file = "new_dawn.dds"
				}
				colors={
					"black"
					"black"
					"null"
					"null"
				}
			}
			day_zero_contact = no
			effect = {
				establish_communications_no_message = root.owner
			}
		}
		last_created_country = {
			set_country_flag = incoming_asteroid
			create_fleet = {
				name = "NAME_Asteroid"
				effect = {
					set_aggro_range = 0
					set_fleet_stance = aggressive
					set_aggro_range_measure_from = self
					set_owner = PREV
					set_fleet_flag = asteroid_fleet
					save_event_target_as = asteroid_fleet_target
					create_ship = {
						name = "NAME_Asteroid"
						design = "NAME_Asteroid"
					}
					set_location = {
						target = ROOT
						distance = 250
						angle = random
					}
					queue_actions = {
						move_to = ROOT
						effect = {
							id = "colony.180.effect.1"
							ROOT = {
								planet_event = { id = colony.183 }
							}
						}
					}
				}
			}
			set_relation_flag = {
				who = root.owner
				flag = asteroid_enemy
			}
		}
	}
	
	option = {
		trigger = {
			owner = { NOT = { has_authority = auth_machine_intelligence } }
		}
		name = colony.180.a
		begin_event_chain = {
			event_chain = "asteroid_sighted_chain"
			target = root.owner
		}
	}

	option = {
		trigger = { owner = { has_authority = auth_machine_intelligence } }
		name = colony.180.b
		begin_event_chain = {
			event_chain = "asteroid_sighted_chain"
			target = root.owner
		}
	}
}

### Colony_Events_3 ###
planet_event = { #science
	id = colony.3010
	title = "colony.3010.name"
	desc = "colony.3010.desc"
	picture = GFX_evt_news_room
	location = ROOT

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		owner = {
			add_monthly_resource_mult = {
					resource = physics_research
					value = @tier2researchreward
					min = @tier2researchmin
					max = @tier2researchmax
			}
			if = {
				limit = {
					has_tech_option = tech_power_plant_4
				}
				add_tech_progress = {
					tech = tech_power_plant_4
					progress = 0.5
				}
			}
			else_if = {
				limit = {
					has_technology = tech_power_plant_3
				}
				add_research_option = tech_power_plant_4
				add_tech_progress = {
					tech = tech_power_plant_4
					progress = 0.25
				}
			}	
			else_if = {
					limit = {
						has_tech_option = tech_power_plant_3
					}
					add_tech_progress = {
						tech = tech_power_plant_3
						progress = 0.5
					}
			}
			else = {
				add_research_option = tech_power_plant_3
				add_tech_progress = {
					tech = tech_power_plant_3
					progress = 0.25
				}
			}
		}
		custom_tooltip = portal_closed_tooltip
		hidden_effect = { set_planet_flag = dportal_closed }
	}
}

planet_event = { #prayer
	id = colony.3011
	title = "colony.3010.name"
	desc = "colony.3011.desc"
	desc = {
		text = colony.3011.psi.desc
		trigger = {
			owner = {
				has_technology = tech_psionic_theory
			}
		}
	}
	desc = {
		text = colony.3011.desc
		trigger = {
			owner = {
				NOT = { has_technology = tech_psionic_theory }
			}
		}
	}
	picture = GFX_evt_news_room
	location = ROOT

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			if = {	
				limit = {
					NOT = { has_tech_option = tech_psionic_theory }
				}
				add_research_option = tech_psionic_theory
				add_tech_progress = {
					tech = tech_psionic_theory
					progress = 0.8
				}
			}
			
			add_research_option = tech_psionic_barrier
			add_tech_progress = {
				tech = tech_psionic_barrier
				progress = 0.5
			}
		}
		custom_tooltip = portal_closed_tooltip
		hidden_effect = { set_planet_flag = dportal_closed }
	}
}

planet_event = { #rocks
	id = colony.3012
	title = "colony.3010.name"
	desc = "colony.3012.desc"
	picture = GFX_evt_news_room
	location = ROOT

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			if = {
				limit = {
					has_tech_option = tech_mining_3
				}
				add_tech_progress = {
					tech = tech_mining_3
					progress = 0.5
				}
			}
			else_if = {
				limit = {
					has_technology = tech_mining_2
				}
				add_research_option = tech_mining_3
				add_tech_progress = {
					tech = tech_mining_3
					progress = 0.25
				}
			}	
			else_if = {
				limit = {
					has_tech_option = tech_mining_2
				}
				add_tech_progress = {
					tech = tech_mining_2
					progress = 0.5
				}
			}
			else = {
				add_research_option = tech_mining_2
				add_tech_progress = {
					tech = tech_mining_2
					progress = 0.25
				}
			}	
		}
		custom_tooltip = portal_closed_tooltip
		hidden_effect = { set_planet_flag = dportal_closed }
	}
}

planet_event = { #message 2
	id = colony.3021
	title = "colony.3020.name"
	desc = {
		text = colony.3021.desc
		trigger = {
			 owner = { is_machine_empire = no }
		}
	}
	desc = {
		text = colony.3021.desc.robot
		trigger = {
			 owner = { is_machine_empire = yes }
		}
	}

	is_triggered_only = yes
	
	diplomatic = yes
	
	picture_event_data = {
		portrait = root.owner.leader
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}
	
	option = {
		name = colony.3021.a #talk more
		trigger = { owner = { is_machine_empire = no } }
		hidden_effect = {
			planet_event = { id = colony.3022 }
		}
	}
	
	option = {
		name = colony.3021.b #just trade
		trigger = { owner = { is_machine_empire = no } }
		response_text = mirror_trade_reply
		set_planet_flag = dportal_trader
		hidden_effect = {
			add_modifier = {
				modifier = "dportal_trade_normal"
				days = -1
			}
			owner = {
				set_country_flag = dportal_trader
				set_variable = { which = dportal_empire_crisis value = 0 }
				set_variable = { which = dportal_empire_victory value = 0 }
				set_variable = { which = dportal_empire_final_victory value = 0 }
			}
		}
	}
	option = {
		name = colony.3021.a.robot #talk more
		trigger = { owner = { is_machine_empire = yes } }
		hidden_effect = {
			planet_event = { id = colony.3022 }
		}
	}
	
	option = {
		name = colony.3021.b.robot #just trade
		trigger = { owner = { is_machine_empire = yes } }
		response_text = mirror_trade_reply.robot
		set_planet_flag = dportal_trader
		hidden_effect = {
			add_modifier = {
				modifier = "dportal_trade_normal"
				days = -1
			}
			owner = {
				set_country_flag = dportal_trader
				set_variable = { which = dportal_empire_crisis value = 0 }
				set_variable = { which = dportal_empire_victory value = 0 }
				set_variable = { which = dportal_empire_final_victory value = 0 }
			}
		}
	}
}

planet_event = { #message 5
	id = colony.3024
	title = "colony.3020.name"
	desc = {
		text = colony.3024.desc
		trigger = {
			 owner = { is_machine_empire = no }
		}
	}
	desc = {
		text = colony.3024.desc.robot
		trigger = {
			 owner = { is_machine_empire = yes }
		}
	}

	is_triggered_only = yes
	
	diplomatic = yes
	
	picture_event_data = {
		portrait = root.owner.leader
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}
	
	option = {
		name = colony.3024.a #trade
		response_text = mirror_trade_reply2
		set_planet_flag = dportal_trader
		hidden_effect = {
			add_modifier = {
				modifier = "dportal_trade_normal"
				days = -1
			}
			owner = {
				set_country_flag = dportal_trader
				set_variable = { which = dportal_empire_crisis value = 0 }
				set_variable = { which = dportal_empire_victory value = 0 }
				set_variable = { which = dportal_empire_final_victory value = 0 }
			}
		}
	}
	option = {
		name = colony.3024.a.robot #trade
		exclusive_trigger = { owner = { is_machine_empire = yes } }
		response_text = mirror_trade_reply2.robot
		set_planet_flag = dportal_trader
		hidden_effect = {
			add_modifier = {
				modifier = "dportal_trade_normal"
				days = -1
			}
			owner = {
				set_country_flag = dportal_trader
				set_variable = { which = dportal_empire_crisis value = 0 }
				set_variable = { which = dportal_empire_victory value = 0 }
				set_variable = { which = dportal_empire_final_victory value = 0 }
			}
		}
	}
}

event = {
	id = colony.3029
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_playable_country = {
			has_country_flag = dportal_trader
		}
	}

	immediate = {
		random_playable_country = {
			limit = { has_country_flag = dportal_trader }
			country_event = { id = colony.3030 days = 1 random = 1080 }
		}
	}
}

country_event = { #Mirror portal followup events
	id = colony.3030

	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		has_country_flag = dportal_trader
		NOR = {
			has_country_flag = dportal_empire_crisis_flag
			has_country_flag = dportal_empire_truce_flag
			has_country_flag = dportal_empire_victory_flag
		}
	}
	
	immediate = {
		random_owned_planet = {
			limit = {
				has_planet_flag = dportal_trader
			}
			save_event_target_as = dportal_trade_planet
		}
		event_target:dportal_trade_planet = {
			remove_planet_flag = trade_changed # just in case
			if = {
				limit = {
					has_modifier = dportal_trade_normal
				}
				random_list = {
					100 = { } #no effect
					10 = {
						planet_event = { id = colony.3031 } #trade goes up
						set_planet_flag = trade_changed
						modifier = {
							factor = 1.25
							owner = { has_country_flag = dportal_empire_weapon_1 }
						}
						modifier = {
							factor = 1.25
							owner = { has_country_flag = dportal_empire_weapon_2 }
						}
					}
					10 = {
						planet_event = { id = colony.3032 } #trade goes down
						set_planet_flag = trade_changed
					}
				}
			}
			else_if = {
				limit = {
					has_modifier = dportal_trade_low
				}
				random_list = {
					20 = { } #no effect
					20 = {
						planet_event = { id = colony.3031 } #trade goes up
						set_planet_flag = trade_changed
						modifier = {
							factor = 1.25
							owner = { has_country_flag = dportal_empire_weapon_1 }
						}
						modifier = {
							factor = 1.25
							owner = { has_country_flag = dportal_empire_weapon_2 }
						}
					}
					10 = {
						planet_event = { id = colony.3032 } #trade goes down
						set_planet_flag = trade_changed
					}	
				}
			}
			else_if = {
				limit = {
					has_modifier = dportal_trade_high
				}
				random_list = {
					40 = {} #no effect
					10 = {
						planet_event = { id = colony.3031 } #trade goes up
						set_planet_flag = trade_changed
						modifier = {
							factor = 1.25
							owner = { has_country_flag = dportal_empire_weapon_1 }
						}
						modifier = {
							factor = 1.25
							owner = { has_country_flag = dportal_empire_weapon_2 }
						}
					}
					20 = {
						planet_event = { id = colony.3032 } #trade goes down
						set_planet_flag = trade_changed
					}	
				}
			}
			
			if = {
				limit = { NOT = { has_planet_flag = trade_changed } }
				random_list = {
					100 = { }
					# unemployed volunteers
					5 = { planet_event = { id = colonyexpanded.503 } }
					# Asks for alloys
					5 = { planet_event = { id = colonyexpanded.504 } }
					# Asks for food
					3 = { planet_event = { id = colonyexpanded.505 } }
					# Live Warp Beast
					3 = { planet_event = { id = colonyexpanded.506 } }
					# Gas for Plasma
					4 = { planet_event = { id = colonyexpanded.508 } }
					# asks for consumer goods / minerals
					5 = { planet_event = { id = colonyexpanded.509 } }
					# Weapons Research
					5 = { planet_event = { id = colonyexpanded.510 } }
					# Warp beast dimension
				}
			}
		}
	}
	after = {
		event_target:dportal_trade_planet = { remove_planet_flag = trade_changed }
	}
}

planet_event = { #trade up
	id = colony.3031
	title = "colony.3031.name"
	desc = "colony.3031.desc"
	picture = GFX_evt_wormhole
	location = ROOT

	is_triggered_only = yes
	
	immediate = {
	}

	option = {
		name = EXCELLENT
		
		if = {
			limit = {
				has_modifier = dportal_trade_low
			}
			hidden_effect = {
				remove_modifier = dportal_trade_low
				add_modifier = {
					modifier = "dportal_trade_normal"
					days = -1
				}
			}
		}
		else_if = {
			limit = {
				has_modifier = dportal_trade_normal
			}
			hidden_effect = {
				remove_modifier = dportal_trade_normal
				add_modifier = {
					modifier = "dportal_trade_high"
					days = -1
				}
			}
		}
		else_if = {
			limit = {
				has_modifier = dportal_trade_high
			}
			owner = {
				add_monthly_resource_mult = {
					resource = consumer_goods
					value = 6
					min = 100
				}
				add_monthly_resource_mult = {
					resource = volatile_motes
					value = 3
					min = 50
				}
				add_monthly_resource_mult = {
					resource = exotic_gases
					value = 3
					min = 50
				}
				add_monthly_resource_mult = {
					resource = rare_crystals
					value = 3
					min = 50
				}
				hidden_effect = {
					if = {
						limit = {
							check_variable = {
								which = dportal_empire_crisis
								value > 0
							}
						}
						change_variable = {
							which = dportal_empire_crisis
							value = -1
						}
					}
					else = {
						change_variable = {
							which = dportal_empire_victory
							value = 1
						}
						if = {
							limit = {
								check_variable = {
									which = dportal_empire_victory
									value > 11
								}
							}
							ROOT = {
								planet_event = { id = colonyexpanded.501 days = 60 random = 360 }
							}
						}
					}
				}
			}
		}
	}
}

planet_event = { #trade down
	id = colony.3032
	title = "colony.3032.name"
	desc = "colony.3032.desc"
	picture = GFX_evt_wormhole
	location = ROOT

	is_triggered_only = yes
	
	immediate = {
	}
	
	option = {
		name = colony.3032.a.robot 
		exclusive_trigger = { owner = { is_machine_empire = yes } }
		if = {
			limit = {
				has_modifier = dportal_trade_high
			}
			hidden_effect = {
				remove_modifier = dportal_trade_high
				add_modifier = {
					modifier = "dportal_trade_normal"
					days = -1
				}
			}
		}
		else_if = {
			limit = {
				has_modifier = dportal_trade_normal
			}
			hidden_effect = {
				remove_modifier = dportal_trade_normal
				add_modifier = {
					modifier = "dportal_trade_low"
					days = -1
				}
			}
		}
		else_if = {
			limit = {
				AND = {
					has_modifier = dportal_trade_low
					owner = {
						check_variable = {
							which = dportal_empire_victory
							value > 5
						}
					}
				}
			}
			owner = { 
				hidden_effect = {
					change_variable = {
						which = dportal_empire_victory
						value = -2
					}
				}
			}
		}
		else_if = {
			limit = {
				AND = {
					has_modifier = dportal_trade_low
					owner = {
						check_variable = {
							which = dportal_empire_victory
							value > 0
						}
					}
				}
			}
			owner = { 
				hidden_effect = {
					change_variable = {
						which = dportal_empire_victory
						value = -1
					}
				}
			}
		}
		else_if = {
			limit = {
				AND = {
					has_modifier = dportal_trade_low
					owner = {
						check_variable = {
								which = dportal_empire_crisis
								value < 5
						}
					}
				}
			}
			owner = { 
				hidden_effect = {
					change_variable = {
						which = dportal_empire_crisis
						value = 1
					}
				}
			}
		}
		else_if = {
			limit = {
				AND = {
					has_modifier = dportal_trade_low
					owner = {
						check_variable = {
								which = dportal_empire_crisis
								value >= 5
						}
					}
				}
			}
			hidden_effect = {
				remove_modifier = dportal_trade_low
				add_modifier = {
					modifier = "dportal_trade_crisis"
					days = -1
				}
				planet_event = { id = colony.3033 days = 1825 random = 1825 }
				planet_event = { id = colonyexpanded.500 days = 360 random = 360 }
				planet_event = { id = colonyexpanded.500 days = 720 random = 720 }
				planet_event = { id = colonyexpanded.500 days = 1080 random = 720 }
				planet_event = { id = colonyexpanded.500 days = 1440 random = 720 }
				planet_event = { id = colonyexpanded.500 days = 1800 random = 720 }
				planet_event = { id = colonyexpanded.500 days = 2160 random = 720 }
				planet_event = { id = colonyexpanded.500 days = 2520 random = 720 }
				owner = { set_country_flag = dportal_empire_crisis_flag }
			}
		}
	}
	option = {
		name = colony.3032.a 
		
		if = {
			limit = {
				has_modifier = dportal_trade_high
			}
			hidden_effect = {
				remove_modifier = dportal_trade_high
				add_modifier = {
					modifier = "dportal_trade_normal"
					days = -1
				}
			}
		}
		else_if = {
			limit = {
				has_modifier = dportal_trade_normal
			}
			hidden_effect = {
				remove_modifier = dportal_trade_normal
				add_modifier = {
					modifier = "dportal_trade_low"
					days = -1
				}
			}
		}
		else_if = {
			limit = {
				AND = {
					has_modifier = dportal_trade_low
					owner = {
						check_variable = {
							which = dportal_empire_victory
							value > 5
						}
					}
				}
			}
			owner = { 
				hidden_effect = {
					change_variable = {
						which = dportal_empire_victory
						value = -2
					}
				}
			}
		}
		else_if = {
			limit = {
				AND = {
					has_modifier = dportal_trade_low
					owner = {
						check_variable = {
							which = dportal_empire_victory
							value > 0
						}
					}
				}
			}
			owner = { 
				hidden_effect = {
					change_variable = {
						which = dportal_empire_victory
						value = -1
					}
				}
			}
			hidden_effect = {
				random_list = {
					1 = {
						if = {
							limit = {
								owner = {
									has_country_flag = worm_events_available
								}
							}
							planet_event = { id = countryexpanded.210 days = 60 random = 360 }
						}
					}
					9999 = { }
				}
			}
		}
		else_if = {
			limit = {
				AND = {
					has_modifier = dportal_trade_low
					owner = {
						check_variable = {
							which = dportal_empire_crisis
							value < 5
						}
					}
				}
			}
			owner = { 
				hidden_effect = {
					change_variable = {
						which = dportal_empire_crisis
						value = 1
					}
				}
			}
			hidden_effect = {
				random_list = {
					1 = {
						modifier = {
							factor = 2
							owner = {
								check_variable = {
										which = dportal_empire_crisis
										value = 2
								}
							}
						}
						modifier = {
							factor = 10
							owner = {
								check_variable = {
										which = dportal_empire_crisis
										value = 3
								}
							}
						}
						modifier = {
							factor = 500
							owner = {
								check_variable = {
										which = dportal_empire_crisis
										value = 4
								}
							}
						}
						modifier = {
							factor = 1999
							owner = {
								check_variable = {
										which = dportal_empire_crisis
										value = 5
								}
							}
						}
						if = {
							limit = {
								owner = {
									has_country_flag = worm_events_available
								}
							}
							planet_event = { id = countryexpanded.210 days = 60 random = 360 }
						}
					}
					1999 = { }
				}
			}
		}
		else_if = {
			limit = {
				AND = {
					has_modifier = dportal_trade_low
					owner = {
						check_variable = {
								which = dportal_empire_crisis
								value >= 5
						}
					}
				}
			}
			hidden_effect = {
				remove_modifier = dportal_trade_low
				add_modifier = {
					modifier = "dportal_trade_crisis"
					days = -1
				}
				planet_event = { id = colony.3033 days = 1825 random = 1825 }
				planet_event = { id = colonyexpanded.500 days = 360 random = 360 }
				planet_event = { id = colonyexpanded.500 days = 720 random = 720 }
				planet_event = { id = colonyexpanded.500 days = 1080 random = 720 }
				planet_event = { id = colonyexpanded.500 days = 1440 random = 720 }
				planet_event = { id = colonyexpanded.500 days = 1800 random = 720 }
				planet_event = { id = colonyexpanded.500 days = 2160 random = 720 }
				planet_event = { id = colonyexpanded.500 days = 2520 random = 720 }
				owner = { set_country_flag = dportal_empire_crisis_flag }
			}
		}
	}
}

### Colony_Events_4 ###
#Trouble in Paradise
planet_event = {
	id = colony.2001
	title = colony.2001.name
	desc = colony.2001.desc
	picture = GFX_evt_smugglers_in_bar
	show_sound = event_conversation
	location = root

	trigger = {
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		owner = {
			OR = {
				has_ethic = ethic_fanatic_militarist
				has_ethic = ethic_militarist
				has_ethic = ethic_fanatic_pacifist
				has_ethic = ethic_pacifist
			}
			NOR = {
				has_country_flag = colony_event_ethic_diverge 
				has_ethic = ethic_gestalt_consciousness
			}
		}
		has_ground_combat = no
		is_occupied_flag = no
		num_pops > 0
		is_capital = no
		OR = {
			is_planet_class = pc_continental
			is_planet_class = pc_tropical
			is_planet_class = pc_mangrove
			is_planet_class = pc_hajungle
			is_planet_class = pc_gaia
		}
		NOT = {
			has_planet_flag = colony_event
		}
	}

	is_triggered_only = yes

	immediate = {
		set_planet_flag = colony_event
		owner = {
			set_timed_country_flag = { flag = colony_event_ethic_diverge days = 1825 } # 5 years
		}
	}

	option = {
		name = colony.2001.a
		custom_tooltip = colony.2001.a.pacifist.tooltip
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_militarist
					has_ethic = ethic_fanatic_militarist
				}
			}
		}
		hidden_effect = {
			random_pop = {
				limit = {
					is_non_sapient_robot = no
					NOR = {
						has_ethic = ethic_pacifist
						has_pop_flag = pop_changed_ethics
					}
				}
				set_timed_pop_flag = { flag = ethic_diverge_from_militarist days = 7 }
				pop_diverge_ethic = yes #Scripted effect controlled by the pop flag set before it
			}
			random_pop = {
				limit = {
					is_non_sapient_robot = no
					NOR = {
						has_ethic = ethic_pacifist
						has_pop_flag = pop_changed_ethics
					}
				}
				set_timed_pop_flag = { flag = ethic_diverge_from_militarist days = 7 }
				pop_diverge_ethic = yes
			}
			random_pop = {
				limit = {
					is_non_sapient_robot = no
					NOR = {
						has_ethic = ethic_pacifist
						has_pop_flag = pop_changed_ethics
					}
				}
				set_timed_pop_flag = { flag = ethic_diverge_from_militarist days = 7 }
				pop_diverge_ethic = yes
			}
		}
	}
	option = {
		name = colony.2001.a
		custom_tooltip = colony.2001.a.military.tooltip
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_pacifist
					has_ethic = ethic_fanatic_pacifist
				}
			}
		}
		hidden_effect = {
			random_pop = {
				limit = {
					is_non_sapient_robot = no
					NOR = {
						has_ethic = ethic_militarist
						has_pop_flag = pop_changed_ethics
					}
				}
				set_timed_pop_flag = { flag = ethic_diverge_from_pacifist days = 7 }
				pop_diverge_ethic = yes
			}
			random_pop = {
				limit = {
					is_non_sapient_robot = no
					NOR = {
						has_ethic = ethic_militarist
						has_pop_flag = pop_changed_ethics
					}
				}
				set_timed_pop_flag = { flag = ethic_diverge_from_pacifist days = 7 }
				pop_diverge_ethic = yes
			}
			random_pop = {
				limit = {
					is_non_sapient_robot = no
					NOR = {
						has_ethic = ethic_militarist
						has_pop_flag = pop_changed_ethics
					}
				}
				set_timed_pop_flag = { flag = ethic_diverge_from_pacifist days = 7 }
				pop_diverge_ethic = yes
			}
		}
	}
	option = {
		name = colony.2001.b
		custom_tooltip = colony.2001.b.pacifism.tooltip
		trigger = {
			owner = {
				NOR = {
					has_ethic = ethic_fanatic_pacifist
					has_ethic = ethic_pacifist
					has_ethic = ethic_fanatic_egalitarian
				}
			}
		}
		hidden_effect = {
			random_pop = {
				limit = {
					is_non_sapient_robot = no
					NOR = {
						has_ethic = ethic_pacifist
						has_pop_flag = pop_changed_ethics
					}
				}
				set_timed_pop_flag = { flag = ethic_diverge_from_militarist days = 7 }
				pop_diverge_ethic = yes
			}
			add_modifier = {
				modifier = suppressed_opposition
				days = 3600
			}
			set_timed_planet_flag = {
				flag = suppressed_opposition_flag
				days = 3600
			}
		}
	}
	option = {
		name = colony.2001.b
		custom_tooltip = colony.2001.b.military.tooltip
		trigger = {
			owner = {
				NOR = {
					has_ethic = ethic_fanatic_militarist
					has_ethic = ethic_militarist
					has_ethic = ethic_fanatic_egalitarian
				}
			}
		}
		hidden_effect = {
			random_pop = {
				limit = {
					is_non_sapient_robot = no
					NOR = {
						has_ethic = ethic_militarist
						has_pop_flag = pop_changed_ethics
					}
				}
				set_timed_pop_flag = { flag = ethic_diverge_from_pacifist days = 7 }
				pop_diverge_ethic = yes
			}
			add_modifier = {
				modifier = suppressed_opposition
				days = 3600
			}
			set_timed_planet_flag = {
				flag = suppressed_opposition_flag
				days = 3600
			}
		}
	}
}

#Submerged Cruiser
planet_event = {
	id = colony.2005
	title = colony.2005.name
	desc = colony.2005.desc
	picture = GFX_evt_ocean
	show_sound = event_sensor_ping
	location = root
	trackable = yes

	trigger = {
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		# TODO: Fix
		#sector_controlled = no
		owner = {
			has_technology = tech_destroyers
			NOT = { has_country_flag = colony_submerged_cruiser }
		}
		has_ground_combat = no
		is_occupied_flag = no
		num_pops > 0
		is_capital = no
		NOT = {
			has_planet_flag = colony_event
		}
		OR = {
			is_planet_class = pc_continental
			is_planet_class = pc_tropical
			is_planet_class = pc_mangrove
			is_planet_class = pc_desertislands
			is_planet_class = pc_hajungle
			is_planet_class = pc_swamp
			is_planet_class = pc_gaia
			is_planet_class = pc_ocean
		}
	}

	is_triggered_only = yes

	immediate = {
		set_planet_flag = colony_event
		owner = { set_country_flag = colony_submerged_cruiser }
	}

	option = {
		name = colony.2005.a
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_fanatic_materialist
					has_ethic = ethic_materialist
				}
			}
		}
		enable_special_project = {
			name = "ANCIENT_OCEAN_SHIP"
			owner = root
			location = root
		}
	}
	option = {
		name = colony.2005.a
		trigger = {
			owner = {
				NOR = {
					has_ethic = ethic_fanatic_materialist
					has_ethic = ethic_materialist
				}
			}
		}
		enable_special_project = {
			name = "ANCIENT_OCEAN_SHIP"
			owner = root
			location = root
		}
	}
	option = {
		name = colony.2005.b
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_fanatic_spiritualist
					has_ethic = ethic_spiritualist
				}
				NOT = { has_technology = tech_destroyers }
			}
		}
		owner = {
			if = {
				limit = {
					has_tech_option = tech_destroyers
				}
				add_tech_progress = {
					tech = tech_destroyers
					progress = 0.60
				}
			}
			else = {
				add_research_option = tech_destroyers
				add_tech_progress = {
					tech = tech_destroyers
					progress = 0.20
				}
			}
		}
	}
	option = {
		name = colony.2005.b
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_fanatic_spiritualist
					has_ethic = ethic_spiritualist
				}
				has_technology = tech_destroyers
				NOT = { has_technology = tech_cruisers }
			}
		}
		owner = {
			if = {
				limit = {
					has_tech_option = tech_cruisers
				}
				add_tech_progress = {
					tech = tech_cruisers
					progress = 0.60
				}
			}
			else = {
				add_research_option = tech_cruisers
				add_tech_progress = {
					tech = tech_cruisers
					progress = 0.20
				}
			}
		}
	}
	option = {
		name = colony.2005.b
		trigger = {
			owner = {
				NOR = {
					has_ethic = ethic_fanatic_spiritualist
					has_ethic = ethic_spiritualist
				}
				NOT = { has_technology = tech_destroyers }
			}
		}
		owner = {
			if = {
				limit = {
					has_tech_option = tech_destroyers
				}
				add_tech_progress = {
					tech = tech_destroyers
					progress = 0.60
				}
			}
			else = {
				add_research_option = tech_destroyers
				add_tech_progress = {
					tech = tech_destroyers
					progress = 0.20
				}
			}
		}
	}
	option = {
		name = colony.2005.b
		trigger = {
			owner = {
				NOR = {
					has_ethic = ethic_fanatic_spiritualist
					has_ethic = ethic_spiritualist
				}
				has_technology = tech_destroyers
				NOT = { has_technology = tech_cruisers }
			}
		}
		owner = {
			if = {
				limit = {
					has_tech_option = tech_cruisers
				}
				add_tech_progress = {
					tech = tech_cruisers
					progress = 0.60
				}
			}
			else = {
				add_research_option = tech_cruisers
				add_tech_progress = {
					tech = tech_cruisers
					progress = 0.20
				}
			}
		}
	}
}

# Clerical Errors
planet_event = {
	id = colony.2050
	title = colony.2050.name
	desc = colony.2050.desc
	picture = GFX_evt_colony_settlement
	show_sound = event_planetary_riot
	location = root

	trigger = {
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		is_capital = no
		has_ground_combat = no
		is_occupied_flag = no
		num_pops > 0
		has_building = yes
		NOR = {
			has_planet_flag = colony_event
			is_planet_class = pc_habitat
		}
		owner = {
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
	}

	is_triggered_only = yes

	immediate = {
		set_planet_flag = colony_event
	}

	option = {
		name = UNFORTUNATE
		add_deposit = d_decrepit_dwellings
		add_deposit = d_failing_infrastructure
		random_list = {
			50 = {
				random_pop = {
					limit = { is_valid_refugee_pop = yes }
					save_event_target_as = refugee_pop #Must be saved for refugee_pop_effect to work
					refugee_pop_effect = yes
				}
			}
			50 = {
				# nothing
			}
		}
	}
	option = {
		name = colony.2050.b
		#custom_tooltip = colony.2050.b.tooltip
		trigger = {
			owner = {
				resource_stockpile_compare = { resource = influence value >= 100 }
				resource_stockpile_compare = { resource = energy value >= 500 }
				NOR = {
					#has_policy = democratic_utopia
					has_ethic = ethic_fanatic_authoritarian
					has_ethic = ethic_authoritarian
				}
			}
		}
		owner = {
			add_resource = {
				energy = -500
				influence = -100
			}
			add_monthly_resource_mult = {
   				resource = unity
   				value = @tier2unityreward
   				min = @tier2unitymin
   				max = @tier2unitymax
   			}
		}
	}
	option = {
		name = colony.2050.c
		#custom_tooltip = colony.2050.b.tooltip
		trigger = {
			owner = {
				resource_stockpile_compare = { resource = influence value >= 50 }
				resource_stockpile_compare = { resource = energy value >= 250 }
				OR = {
					#has_government = democratic_utopia
					has_ethic = ethic_fanatic_authoritarian
					has_ethic = ethic_authoritarian
				}
			}
		}
		owner = {
			add_resource = {
				energy = -250
				influence = -50
			}
			add_monthly_resource_mult = {
   				resource = unity
   				value = @tier2unityreward
   			}
		}
	}
	option = {
		name = colony.2050.d
		add_planet_devastation = 20
		trigger = {
			owner = {
				OR = {
					has_government = gov_despotic_hegemony
					has_government = gov_totalitarian_regime
					has_government = gov_despotic_empire
					has_government = gov_feudal_empire
					has_government = gov_constitutional_dictatorship
					has_government = gov_military_commissariat
					has_government = gov_citizen_republic
					has_government = gov_megacorporation
					has_government = gov_military_dictatorship
					has_government = gov_star_empire
				}
			}
		}
		owner = {
			add_monthly_resource_mult = {
   				resource = influence
   				value = @tier2influencereward
    			min = @tier2influencemin
   				max = @tier2influencemax
   			}	
		}
		random_owned_pop = {
			limit = { is_pop_category = worker }
			add_modifier = {
				modifier = pop_angered
				days = 7300
			}
		}
		random_owned_pop = {
			limit = {
				NOT = { has_modifier = pop_angered }
				is_pop_category = worker
			}
			add_modifier = {
				modifier = pop_angered
				days = 7300
			}
		}
		random_list = {
			50 = {
				random_pop = {
					limit = { is_valid_refugee_pop = yes }
					save_event_target_as = refugee_pop #Must be saved for refugee_pop_effect to work
					refugee_pop_effect = yes
				}
			}
			50 = {
				# nothing
			}
		}
	}
}