namespace = distar

# Randomize L-Cluster outcome on_game_start
event = {
	id = distar.8000
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_list = {
			33 = {
				set_global_flag = gray_goo_crisis_set
				set_global_flag = active_gray_goo
			}
			33 = { set_global_flag = dragon_season }
			33 = { set_global_flag = gray_goo_empire_set }
		}
	}
}

country_event = {
	id = distar.214
	title = "distar.214.name"
	desc = "distar.214.desc"
	picture = GFX_evt_fleet_good
	show_sound = event_mystic_reveal
	location = event_target:ahab_fleet
	
	is_triggered_only = yes

	immediate = {
		create_country = {
			name = "NAME_Reth_Unddol"
			type = faction
			auto_delete = yes
			flag = {
    		    icon = {
    		        category = "special"
    		        file = "unknown.dds"
    		    }
    		    background = {
    		        category = "backgrounds"
    		        file = "00_solid.dds"
    		    }
    		    colors = {
    		        "red"
    		        "null"
    		        "null"
    		        "null"
    		    }
    		}
    		effect = {
    			save_event_target_as = reth_country
    		}
    	}
    	event_target:reth_country = { 
    		set_faction_hostility = {
				target = root.owner
				set_hostile = no
				set_neutral = no
				set_friendly = yes
			}
			IF = {
				LIMIT = { host_has_dlc = "Humanoids Species Pack" }
				create_species = {
					name = "NAME_Unknown"
					class = HUM
					portrait = humanoid_hp_12
					namelist = "PRT1"
					traits = random
					effect = {
						save_event_target_as = captain_species
					}
				}
			}
			ELSE = {
				create_species = {
					name = "NAME_Unknown"
					class = MAM
					portrait = mam14
					namelist = "PRT1"
					traits = random
					effect = {
						save_event_target_as = captain_species
					}
				}
			}
			create_leader = {
				class = admiral
				species = event_target:captain_species
				name = "NAME_Reth_Unddol"
				skill = 5
				gender = male
				event_leader = no
			}
			last_created_leader = {
				add_trait = leader_trait_admiral_hells_heart
				save_event_target_as = captain_reth
			}
			create_fleet = {
				name = "NAME_AH4B"
				effect = {
					set_owner = prev
					create_ship = {
						name = "NAME_AH4B"
						design = "NAME_AH4B"
						prefix = no
						upgradable = yes
					}
					set_location = {
						target = event_target:dead_matriarch
						distance = 2
						angle = random
					}
					set_fleet_stance = passive
					add_modifier = { modifier = "ahab_power" days = -1 }
					assign_leader = event_target:captain_reth
					save_event_target_as = ahab_fleet
				}
				settings = {
					can_upgrade = yes
					can_change_composition = yes
					can_change_leader = yes
					spawn_debris = no
				}
			}
		}
	}

	option = {
		name = ONSCREEN
		hidden_effect = {
			country_event = { id = distar.215 }
		}
	}
}

ship_event = {
	id = distar.156
	title = "distar.156.name" 
	desc = {
		trigger = {
			owner = { NOT = { has_authority = auth_machine_intelligence } }
		}
		text = "distar.156.desc"
	}
	desc = {
		trigger = {
			owner = { has_authority = auth_machine_intelligence }
		}
		text = "distar.156.desc.machi"
	}
	picture = GFX_evt_space_debris
	show_sound = event_construction
	location = event_target:repaired_warform
	
	is_triggered_only = yes

	immediate = {
		save_event_target_as = research_ship

		create_country = {
			name = "NAME_S8751"
			type = faction
			auto_delete = yes
			flag = {
    		    icon = {
    		        category = "special"
    		        file = "unknown.dds"
    		    }
    		    background = {
    		        category = "backgrounds"
    		        file = "00_solid.dds"
    		    }
    		    colors = {
    		        "green"
    		        "green"
    		        "null"
    		        "null"
    		    }
    		}
    		effect = {
    			save_event_target_as = warform_country
    		}
    	}
    	event_target:warform_country = {
    		set_faction_hostility = {
				target = root.owner
				set_hostile = no
				set_neutral = no
				set_friendly = yes
			}
			IF = {
				LIMIT = { host_has_dlc = "Synthetic Dawn Story Pack" }
				create_species = {
					name = "NAME_S8751"
					class = ROBOT
					portrait = sd_rep_robot
					namelist = "AI"
					traits = {
						trait = trait_mechanical
						trait = random_traits
					}
					effect = {
						save_event_target_as = warform_species
					}
				}
			}
			ELSE = {
				create_species = {
					name = "NAME_S8751"
					class = ROBOT
					portrait = default_robot
					namelist = "AI"
					traits = {
						trait = trait_mechanical
						trait = random_traits
					}
					effect = {
						save_event_target_as = warform_species
					}
				}
			}
			create_leader = {
				class = admiral
				species = event_target:warform_species
				name = "NAME_S8751"
				skill = 10
				event_leader = yes
			}
			last_created_leader = {
				save_event_target_as = warform_leader
			}
			create_fleet = {
				name = "NAME_S8751"
				effect = {
					set_owner = prev
					create_ship = {
						name = "NAME_S8751"
						design = "NAME_S8751"
						prefix = no
						upgradable = no
					}
					set_location = {
						target = root
						distance = 10
						angle = random
					}
					set_fleet_stance = passive
					add_modifier = { modifier = "big_friendly_warform_power" days = -1 }
					assign_leader = event_target:warform_leader
					set_fleet_flag = repaired_warform
					save_event_target_as = repaired_warform
				}
				settings = {
					can_upgrade = yes
					can_change_composition = yes
					can_change_leader = yes
					uses_naval_capacity = no
					spawn_debris = yes
				}
			}
		}
	}

	option = {
		name = ONSCREEN
		hidden_effect = {
			owner = {
				country_event = { id = distar.158 }
			}
		}
	}
}