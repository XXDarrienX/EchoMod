namespace = pirate

event = {
    id = pirate.100
    hide_window = yes
    is_triggered_only = yes

    trigger = {
		mid_game_years_passed >= 0
        any_system = {
            has_system_trade_value >= 180
        }
    }

    immediate = {
        random_list = {
            100 = { #Bemat Thalassocracy
				event_target:global_event_country = {
					country_event = { id = pirate.150 days = 1 }
				}
            }
            # More pirate encounters can be added here
            0 = {}
        }
    }
}

country_event = {
    id = pirate.150
    hide_window = yes
    is_triggered_only = yes

	trigger = {
		NOR = {
			exists = event_target:thalassocracy_country
			any_country = { has_country_flag = met_thalassocracy }
		}
	}

    immediate = {
		create_thalassocracy_country = yes
        if = { #Prioritise unoccupied systems
            limit = {
                any_system = {
					num_planets_in_system > 1
                    NOR = {
                        exists = space_owner
                        has_star_flag = hostile_system
                        has_star_flag = guardian
						has_star_flag = tiyanki_home_system
						has_star_flag = amoeba_home_system
						has_star_flag = lcluster
						has_star_flag = sealed_system
                    }
                }
            }
            random_system = {
                limit = {
					num_planets_in_system > 1
                    NOR = {
                        exists = space_owner
                        has_star_flag = hostile_system
                        has_star_flag = guardian
						has_star_flag = tiyanki_home_system
						has_star_flag = amoeba_home_system
						has_star_flag = lcluster
						has_star_flag = sealed_system
                    }
                }
                save_global_event_target_as = thalassocracy_target_system
                random_system_planet = {
                    save_event_target_as = thalassocracy_spawn_planet
                    set_planet_flag = thalassocracy_visited
                }
                random_system_planet = {
                    limit = {
                        NOT = { has_planet_flag = thalassocracy_visited }
                    }
                    save_event_target_as = thalassocracy_target_planet
                }
                create_thalassocracy_fleet = yes
				event_target:thalassocracy_country = {
					set_country_flag = spawned_fleet
				}
            }
        }
        else_if = { #Pop up in a semi-convenient, empire-owned system, if possible
            limit = { #Must be duplicated below, in the random_system effect
                any_system = {
                    exists = space_owner
					num_planets_in_system > 1
                    NOR = {
                        is_pirate_system = yes
                        has_star_flag = hostile_system
                        has_star_flag = guardian
                        has_star_flag = enclave
                        any_system_planet = { is_capital = yes }
                    }
                    has_system_trade_value >= 80
                    distance = {
                        source = this.capital_scope.solar_system
                        use_bypasses = no
                        min_jumps = 2
                        max_jumps = 5
                    }
                }
            }
            random_system = {
                limit = {
                    exists = space_owner
					num_planets_in_system > 1
                    NOR = {
                        is_pirate_system = yes
                        has_star_flag = hostile_system
                        has_star_flag = guardian
						has_star_flag = enclave
						has_star_flag = planet_state
						has_star_flag = ne_enclave
                        any_system_planet = { is_capital = yes }
                    }
                    has_system_trade_value >= 80
                    distance = {
                        source = this.capital_scope.solar_system
                        use_bypasses = no
                        min_jumps = 2
                        max_jumps = 5
                    }
                }
                save_global_event_target_as = thalassocracy_target_system
                random_system_planet = {
                    save_event_target_as = thalassocracy_spawn_planet
                    set_planet_flag = thalassocracy_visited
                }
                random_planet = {
                    limit = {
                        NOT = { has_planet_flag = thalassocracy_visited }
                    }
                    save_event_target_as = thalassocracy_target_planet
                }
                create_thalassocracy_fleet = yes
				event_target:thalassocracy_country = { set_country_flag = spawned_fleet }
				space_owner = {
					country_event = { id = pirate.155 days = 0 } #Establish contact
				}
            }
        }
        else = {
            #Nothing; await next pulse/valid country
        }
    }
}