############################
#
# Observation Post Events
#
# Written by Henrik Eklund
#
############################

namespace = observation

# Asteroid Impacts!
country_event = {
	id = observation.3
	title = "observation.3.name"
	desc = "observation.3.desc"
	picture = GFX_evt_nuclear_explosion
	show_sound = event_super_explosion
	location = event_target:primitive_impact_planet
	
	is_triggered_only = yes
	
	immediate = {
		event_target:primitive_impact_planet = {
			destroy_colony = yes
			change_pc = pc_barren
			reset_planet = yes
			remove_planet_flag = asteroid_sighted_prim_planet
			add_modifier = {
				modifier = terraforming_candidate
				days = -1
			}
		}
		remove_country_flag = asteroid_sighted_prim_country
		remove_global_flag = asteroid_sighted_prim_global
	}
	
	option = {
		name = "observation.3.a"
		event_target:primitive_impact_planet = {
			observation_outpost = {
				dismantle = yes
			}
		}
	}
}

# Asteroid Destroyed (HIDDEN)
country_event = {
	id = observation.5
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		exists = from
		FROM = { has_country_flag = incoming_asteroid_prim }
	}
	
	immediate = {
		random_country = {
			limit = { has_country_flag = asteroid_sighted_prim_country }
			country_event = { id = observation.6 }
		}
	}
}

# Asteroid Destroyed
country_event = {
	id = observation.6
	title = "observation.6.name"
	desc = { 
		text = "observation.6.desc"
		trigger = { NOT = { has_country_flag = primitives_discover_you } }
	}
	desc = { 
		text = "observation.6.b.desc"
		trigger = { has_country_flag = primitives_discover_you }
	}
	picture = GFX_evt_atmospheric_entry
	show_sound = event_ship_explosion
	location = event_target:asteroid_prim_planet
	
	is_triggered_only = yes
	
	immediate = {
		random_planet = {
			limit = { has_planet_flag = asteroid_sighted_prim_planet }
			save_event_target_as = asteroid_prim_planet
		}
		remove_global_flag = asteroid_sighted_prim_global
		remove_country_flag = asteroid_sighted_prim_country
		event_target:asteroid_prim_planet = {
			remove_planet_flag = asteroid_sighted_prim_planet
			if = {
				limit = {
					exists = owner
					owner = {
						is_country_type = primitive
						OR = {
							has_country_flag = machine_age
							has_country_flag = atomic_age 
							has_country_flag = early_space_age
							has_country_flag = mem_lunar_age
							has_country_flag = mem_colony_ship_recently_colonized
						}
					}
				}
				random_list = {
					25 = {
						modifier = {
							factor = 3
							owner = {
								OR = {
									has_country_flag = early_space_age
									has_country_flag = mem_lunar_age
									has_country_flag = mem_colony_ship_recently_colonized
								}
							}
						}
						owner = {
							set_country_flag = primitives_discover_observer
							random_list = {
								25 = {
									shift_ethic = ethic_xenophile
									random_owned_pop = { pop_change_ethic = ethic_xenophile }
									random_owned_pop = { pop_change_ethic = ethic_xenophile }
								}
								75 = {
								}
							}
						}
						ROOT = { set_country_flag = primitives_discover_you }
					}
					75 = {
					}
				}
			}
		}
	}
	
	option = {
		name = "observation.6.a"
		trigger = {
			NOT = { has_country_flag = primitives_discover_you }
		}
		# Influence gain? Xenophile pop happiness bonus?
		hidden_effect = {
			every_owned_pop = {
				limit = { pop_has_ethic = ethic_xenophile }
				add_modifier = {
					modifier = mandate_fulfilled_mod
					days = 720
				}
			}
		}
	}
	option = {
		name = "observation.6.b"
		trigger = {
			has_country_flag = primitives_discover_you
		}
		# Influence gain? Xenophile pop happiness bonus?
		hidden_effect = {
			every_owned_pop = {
				limit = { pop_has_ethic = ethic_xenophile }
				add_modifier = {
					modifier = mandate_fulfilled_mod
					days = 720
				}
			}
			remove_country_flag = primitives_discover_you
		}
	}
}