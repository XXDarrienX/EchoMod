############################
#
# Anomaly Events
#
# Written by Henrik Eklund
#
############################

namespace = anomaly

# ROOT = ship scope
# FROM = planet scope

### Anomaly Events 1 ###

### Ammonia Biosphere
ship_event = {
	id = anomaly.690
	title = "anomaly.690.name"
	desc = "anomaly.690.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_ship_bridge
	location = FROM
	
	is_triggered_only = yes

	immediate = {
		from = { clear_deposits = yes }
		owner = { country_event = { id = story.1 days = 2 } }
		owner = {
			set_timed_country_flag = { flag = found_recent_toxic_life days = 10800 }
		}
		FROM = {
			if = {
				limit = { is_planetary_diversity_active = yes }
				change_pc = pc_ammonia
				reset_planet = yes
			}
		}
	}
	
	option = {
		name = FASCINATING
		hidden_effect = {
			FROM = {
				add_modifier = {
					modifier = "ammonia_biosphere"
					days = -1
				}
			}
		}
		FROM = { 
			set_deposit = d_society_3
		}
	}
}

### Silicon Life Forms
ship_event = {
	id = anomaly.695
	title = "anomaly.695.name"
	desc = "anomaly.695.desc"
	picture = GFX_evt_underground_civilization
	show_sound = event_ship_bridge
	location = FROM
	
	is_triggered_only = yes

	immediate = {
		from = { clear_deposits = yes }
		owner = { country_event = { id = story.2 days = 30 } }
	}
	
	option = {
		name = INTRIGUING
		hidden_effect = {
			FROM = {
				add_modifier = {
					modifier = "silicon_lifeforms"
					days = -1
				}
			}
		}
		FROM = { 
			set_deposit = d_minerals_3
		}
	}
}

### Ocean Beneath the Ice
# Special Project Completed 2
ship_event = {
	id = anomaly.2513
	title = "PROJECT_COMPLETE"
	desc = "anomaly.2513.desc"
	picture = GFX_evt_ship_in_orbit
	show_sound = event_laboratory_sound
	location = FROMFROM
	
	is_triggered_only = yes
	
	option = {
		name = INTERESTING
		leader = { add_experience = 200 }
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
		}
	}
}

### Gigantic Skeleton
ship_event = {
	id = anomaly.2520
	title = "anomaly.2520.name"
	desc = "anomaly.2520.desc"
	picture = GFX_evt_ship_in_orbit
	show_sound = event_ship_bridge
	location = FROM
	trackable = yes
	
	is_triggered_only = yes

	immediate = {
		from = { clear_deposits = yes }
		owner = { country_event = { id = story.2 days = 30 } }
	}
	
	option = {
		trigger = { owner = { NOT = { has_civic = civic_machine_terminator } } }
		name = FASCINATING
		from = {
			enable_special_project = {
				name = "GIGANTIC_SKELETON_PROJECT_MOD"
				location = this
				owner = root.owner
			}
		}
	}
	option = {
		trigger = { owner = { has_civic = civic_machine_terminator } }
		name = "anomaly.2520.a.term"
		from = {
			enable_special_project = {
				name = "GIGANTIC_SKELETON_PROJECT_MOD"
				location = this
				owner = root.owner
			}
		}
	}
}

# Special Project Completed 2
ship_event = {
	id = anomaly.2522
	title = "PROJECT_COMPLETE"
	desc = "anomaly.2522.desc"
	picture = GFX_evt_ship_in_orbit
	show_sound = event_scanner
	location = FROMFROMFROM
	
	is_triggered_only = yes
	
	option = {
		name = ASTOUNDING
		hidden_effect = {
			FROMFROM = {
				add_modifier = {
					modifier = "transdimensional_being"
					days = -1
				}
			}
		}
		leader = { add_experience = 200 }
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
		}
	}
}

### Anomaly Events 2 ###

# Baldarak Science Academy
country_event = {
	id = anomaly.5025
	title = "anomaly.5025.name"
	desc = "anomaly.5025.desc"
	
	diplomatic = yes
	
	picture_event_data = {
		room = no_video_feed_room
	}
	
	trigger = {
		has_country_flag = new_baldarak_settled
		OR = {
			NOT = { has_country_flag = new_baldarak_contact_lost }
			has_country_flag = new_baldarak_occupation_4
			has_country_flag = baldarak_revolution_4
		}
		NOT = { has_country_flag = baldarak_science_academy }
	}
	
	mean_time_to_happen = {
		months = 320
	}
	
	immediate = {
		set_country_flag = baldarak_science_academy
	}
	
	option = {
		name = anomaly.5025.a
		add_monthly_resource_mult = {
			resource = physics_research
			value = @tier3researchreward
			min = @tier3researchmin
			max = @tier3researchmax
		}
	}
}

# Spring Cleaning
country_event = {
	id = anomaly.5026
	title = "anomaly.5026.name"
	desc = "anomaly.5026.desc"
	
	diplomatic = yes
	
	picture_event_data = {
		room = no_video_feed_room
	}
	
	trigger = {
		has_country_flag = new_baldarak_settled
		OR = {
			NOT = { has_country_flag = new_baldarak_contact_lost }
			has_country_flag = new_baldarak_occupation_4
			has_country_flag = baldarak_revolution_4
		}
		NOT = { has_country_flag = baldarak_spring_cleaning }
	}
	
	mean_time_to_happen = {
		months = 320
	}
	
	immediate = {
		set_country_flag = baldarak_spring_cleaning
	}
	
	option = {
		name = anomaly.5026.a
		add_monthly_resource_mult = {
			resource = minerals
			value = @tier1materialreward
			min = @tier1materialmin
			max = @tier1materialmax
		}
	}
}

### Anomaly Events 3 ###
### Thinking Asteroid 2
ship_event = {
	id = anomaly.80
	title = "anomaly.80.name"
	desc = "anomaly.80.desc"
	picture = GFX_evt_mining_station
	show_sound = event_structural_collapse
	location = FROM

	is_triggered_only = yes

	option = {
		name = anomaly.80.a
		leader = { add_trait = leader_trait_carefree }
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			add_monthly_resource_mult = {
				resource = energy
				value = @tier2materialreward
				min = @tier2materialmin
				max = @tier2materialmax
			}
		}
	}
}

### Cunning Flora followup
ship_event = {
	id = anomaly.91
	title = "anomaly.91.name"
	desc = "anomaly.90.desc"
	picture = GFX_evt_big_landing_ship
	show_sound = event_alien_nature
	location = FROM

	is_triggered_only = yes

	option = {
		name = FASCINATING
		fromfrom = {
			add_modifier = {
				modifier = "cunning_flora"
				days = -1
			}
			add_deposit = d_savage_wildlands
			add_deposit = d_dense_jungle
		}
	}
}

### Abandoned Playground, GEN_PLAYGROUND_CAT
# Gives society and engineering research
ship_event = {
	id = anomaly.135
	title = "anomaly.135.name"
	desc = "anomaly.135.desc"
	picture = GFX_evt_alien_city
	show_sound = event_administrative_work
	location = FROM

	is_triggered_only = yes
	auto_opens = yes

	trigger = {
		FROM = {
			NOR = {
				is_planet_class = pc_asteroid
				is_planet_class = pc_gas_giant
			}
		}
	}

	immediate = { owner = { country_event = { id = story.5 days = 30 } } }

	option = {
		name = INTRIGUING
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
		if = {
			limit = {
				from = {
					OR = {
						is_planet_class = pc_barren
						is_planet_class = pc_barren_cold
					}
					planet_size > 9
					planet_size < 26
				}
			}
			custom_tooltip = TERRAFORMING_CANDIDATE_EFFECT
			hidden_effect = {
				from = {
					add_modifier = {
						modifier = "terraforming_candidate"
						days = -1
					}
				}		
			}
		}
	}
}

# Misty Shores
ship_event = {
	id = anomaly.195
	title = "anomaly.195.name"
	desc = "anomaly.195.desc"
	show_sound = event_mystic_reveal
	picture = GFX_evt_ship_in_orbit
	location = FROM

	is_triggered_only = yes

	option = {
		name = FASCINATING
		hidden_effect = { owner = { country_event = { id = story.5 days = 30 } } }
		leader = {
			add_experience = 200
		}
		FROM = {
			add_deposit = d_misty_shores
		}
	}
}

### Anomaly Events 4 ###


### Anomaly Events 5 ###

### Lethal Tropical Wildlife #############################################################################
#story3
ship_event = {
	id = anomaly.4000
	title = "anomaly.4000.name"
	desc = "anomaly.4000.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_alien_nature
	location = FROM
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			owner = {
				country_event = { id = story.5 days = 30 }
			}
		}
	}

	option = {
		name = EXCELLENT
		FROM = {
			add_deposit = d_acid_jungles
			add_deposit = d_noxious_swamp
			add_deposit = d_noxious_swamp
		}
		hidden_effect = {
			owner = {
				country_event = { id = story.3 days = 30 }
			}
		}

	}
}

### Ship Graveyard ######################################################################################
#story5
ship_event = {
	id = anomaly.4020
	title = "anomaly.4020.name"
	picture = GFX_evt_big_landing_ship
	show_sound = event_mystic_reveal
	location = FROM
	desc = {
		text = "anomaly.4020.rocket.desc"
		trigger = {
			NOT = { owner = { has_ethic = ethic_gestalt_consciousness } }
			leader = {
				has_trait = leader_trait_expertise_propulsion
			}
		}
	}
	desc = {
		text = "anomaly.4020.rocket.desc.mach"
		trigger = {
			owner = { has_ethic = ethic_gestalt_consciousness }
			leader = {
				has_trait = leader_trait_expertise_propulsion
			}
		}
	}
	desc = {
		text = "anomaly.4020.desc"
		trigger = {
			leader = {
				NOT = { has_trait = leader_trait_expertise_propulsion }
			}
		}
	}
	
	is_triggered_only = yes

	immediate = { owner = { country_event = { id = story.5 days = 30 } } }

	option = {
		trigger = {
			leader = { has_trait = leader_trait_expertise_propulsion }
		}	
		name = anomaly.4020.b
		FROM = {
			add_modifier = {
				modifier = "ship_graveyard"
				days = -1
			}
			if = {
				limit = { habitable_planet = no }
				add_deposit = d_alloys_2
			}
			else = { add_deposit = d_ship_graveyard }
		}
		owner = {
			pop_lcluster_event = yes
		}
	}
	option = {
		trigger = {
			leader = {
					NOT = { has_trait = leader_trait_expertise_propulsion }
			}
		}
		name = anomaly.4020.a
		FROM = {
			add_modifier = {
				modifier = "ship_graveyard"
				days = -1
			}
			if = {
				limit = { habitable_planet = no }
				add_deposit = d_alloys_2
			}
			else = { add_deposit = d_ship_graveyard }
		}
		owner = {
			pop_lcluster_event = yes
		}
	}
}

### AI Admiral ###########################################################################################
#story5
ship_event = {
	id = anomaly.4030
	title = "anomaly.4030.name"
	desc = "anomaly.4030.desc"
	picture = GFX_evt_archaeological_dig
	show_sound = event_sensor_ping
	location = FROM
	trackable = yes

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			owner = {
				set_country_flag = ai_admiral_found
				country_event = { id = story.5 days = 30 }
			}
		}
	}

	option = {
		name = "anomaly.4030.a"
		FROM = {
			enable_special_project = {
				name = "AI_ADMIRAL_PROJECT"
				owner = root
				location = this
			}
		}
	}
	option = {
		name = "anomaly.4030.b"
		custom_tooltip = "anomaly.4030.b.tooltip"
		hidden_effect = {
			FROM = {
				add_deposit = d_ai_fleet
			}
		}
	}
}

### Sins of a Sun ##########################################################################################
ship_event = {
	id = anomaly.4040
	title = "anomaly.4040.name"
	desc = "anomaly.4040.desc"
	picture = GFX_evt_nuclear_explosion
	show_sound = event_super_explosion
	location = FROM
	
	is_triggered_only = yes

	option = {
		name = CURIOUS
		FROM = {
			add_deposit = d_irradiated_wasteland_anomaly
			add_deposit = d_radioactive_wasteland
			add_deposit = d_radioactive_wasteland
			add_deposit = d_radioactive_wasteland
		}
	}
}

### Echoes from the Deep #################################################################################

#If paranoid - leader finds source and gets stuff
#story 4
ship_event = {
	id = anomaly.4050
	title = "anomaly.4045.name"
	desc = "anomaly.4050.desc"
	picture = GFX_evt_psionics
	show_sound = event_mystic_reveal
	location = FROM
	
	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			leader = {
				add_trait = leader_trait_expertise_psionics
				add_trait = leader_trait_scientist_psionic
				add_experience = 100
			}
		}
	}

	option = {
		name = "anomaly.4050.a"
		custom_tooltip = "anomaly.4050.a.tooltip"
	}
	option = {
		name = "anomaly.4050.b"
		custom_tooltip = "anomaly.4050.a.tooltip"
	}
}

### Diamond in the Rough ##################################################################################
ship_event = {
	id = anomaly.4055
	title = "anomaly.4055.name"
	desc = "anomaly.4055.desc"
	picture = GFX_evt_physics_research
	show_sound = event_laboratory_sound
	location = FROM

	is_triggered_only = yes

	immediate = {
		from = {
			if = {
				limit = { habitable_planet = no }
				clear_deposits = yes
			}
		}
	}

	option = {
		name = anomaly.4055.a
		custom_tooltip = "anomaly.4055.a.tooltip"
		hidden_effect = {
			owner = {
				create_leader = {
					class = scientist
					species = owner_main_species
					name = random
				}
				last_created_leader = {
					add_experience = 200
					if = {
						limit = {
							NOT = {
								has_trait = leader_trait_spark_of_genius
							}
						}
						add_trait = leader_trait_spark_of_genius
					}
				}
			}
			FROM = {
				if = {
					limit = { habitable_planet = no }
					add_deposit = d_minerals_4
					add_deposit = d_minerals_2
					add_deposit = d_rare_crystals_1
				}
				else = {
					add_deposit = d_rich_mountain
					add_deposit = d_crystalline_caverns
				}
			}
		}
	}
	option = {
		name = anomaly.4055.b
		custom_tooltip = "anomaly.4055.b.tooltip"
		hidden_effect = {
			root = {
				add_modifier = {
					modifier = protege_onboard
					days = 7200
				}
			}
			FROM = {
				if = {
					limit = { habitable_planet = no }
					add_deposit = d_minerals_4
					add_deposit = d_minerals_2
					add_deposit = d_rare_crystals_1
				}
				else = {
					add_deposit = d_rich_mountain
					add_deposit = d_crystalline_caverns
				}
			}
		}
	}	
}

### Shifting Sands ##########################################################################################
ship_event = {
	id = anomaly.4110
	title = "anomaly.4110.name"
	desc = {
		trigger = {
			leader = {
				OR = {
					has_trait = leader_trait_spark_of_genius
					has_trait = leader_trait_expertise_new_worlds
				}
			}
		}
		text = "anomaly.4110.success.desc"
	}
	desc = {
		trigger = {
			leader = {
				NOR = {
					has_trait = leader_trait_spark_of_genius
					has_trait = leader_trait_expertise_new_worlds
				}
			}
		}
		text = "anomaly.4110.fail.desc"
	}
	picture = GFX_evt_desert
	show_sound = event_construction
	location = from

	is_triggered_only = yes

	option = {
		trigger = {
			leader = {
				OR = {
					has_trait = leader_trait_spark_of_genius
					has_trait = leader_trait_expertise_new_worlds
				}
			}
		}
		name = SPLENDID
		from = {
			add_deposit = d_liquid_sands
			add_deposit = d_quicksand_basin
			add_deposit = d_quicksand_basin
		}
	}
	option = {
		trigger = {
			leader = {
				NOR = {
					has_trait = leader_trait_spark_of_genius
					has_trait = leader_trait_expertise_new_worlds
				}
			}
		}
		name = UNFORTUNATE
		from = {
			add_modifier = {
				modifier = shifting_sands
				days = 1500
			}
			add_deposit = d_liquid_sands
			add_deposit = d_quicksand_basin
			add_deposit = d_quicksand_basin
			add_deposit = d_quicksand_basin
		}
	}
}

### Repurpose Mining Station #############################################################################
#story5
ship_event = {
	id = anomaly.4125
	title = "anomaly.4125.name"
	desc = {
		trigger = {
			leader = {
				NOT = { has_trait = leader_trait_expertise_voidcraft }
			}
		}
		text = "anomaly.4125.desc"
	}
	desc = {
		trigger = {
			leader = {
				has_trait = leader_trait_expertise_voidcraft
			}
		}
		text = "anomaly.4125.zerog.desc"
	}
	picture = GFX_evt_satellite_in_orbit
	show_sound = event_sensor_ping
	location = from

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			owner = { country_event = { id = story.5 days = 30 } }
			from = { clear_deposits = yes }
		}
	}

	option = {
		trigger = {
			leader = {
				NOT = { has_trait = leader_trait_expertise_voidcraft }
			}
		}
		name = anomaly.4125.a
		custom_tooltip = "anomaly.4125.a.tooltip"
		hidden_effect = {
			from = {
				set_deposit = d_energy_4
				create_mining_station = {
					owner = ROOT
				}
				add_modifier = {
					modifier = abandoned_mining
					days = -1
				}
			}
		}
	}
	option = {
		trigger = {
			leader = {
				has_trait = leader_trait_expertise_voidcraft
			}
		}
		name = anomaly.4125.a
		custom_tooltip = "anomaly.4125.b.tooltip"
		hidden_effect = {
			from = {
				set_deposit = d_energy_4
				create_mining_station = {
					owner = ROOT
				}
				add_modifier = {
					modifier = abandoned_mining
					days = -1
				}
			}
			owner = {
				add_modifier = {
					modifier = zero_gravity_revelation
					days = -1
				}
			}
		}
	}
	option = {
		name = SCRAPIT
		owner = {
			add_monthly_resource_mult = {
				resource = minerals
				value = @tier1materialreward
				min = @tier1materialmin
				max = @tier1materialmax
			}
		}
	}
}


### Anomaly Events 6 ###

# add deposits for mineral modifiers
ship_event = {
	id = anomaly.6662
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		from = {
			OR = { 
				has_modifier = chthonian_planet
				has_modifier = extensive_moon_system
				has_modifier = unstable_tectonics
				has_modifier = ultra_rich
				has_modifier = mineral_rich
				has_modifier = asteroid_impacts
				has_modifier = carbon_world
				has_modifier = asteroid_belt
			}
			NOR = { 
				has_deposit = d_minerals_7
				has_deposit = d_minerals_8
				has_deposit = d_minerals_9
				has_deposit = d_minerals_10
			}
		}
	}

	immediate = {
		from = {
			if = {
				limit = { colonizeable_planet = no }
				prevent_anomaly = yes
				clear_deposits = yes
				add_deposit = d_minerals_7
			}
			else_if = {
				limit = {
					OR = {
						habitable_planet = yes
						is_planet_class = pc_nuked
						is_planet_class = pc_hive
					}
				}
				prevent_anomaly = yes
				add_deposit = d_rich_mountain
			}
		}
	}
}

# add deposits for energy modifiers
ship_event = {
	id = anomaly.6663
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		from = {
			OR = { 
				has_modifier = hazardous_weather
				has_modifier = strong_magnetic_field
				has_modifier = unstable_tectonics
				has_modifier = ultra_rich
				has_modifier = mineral_rich
				has_modifier = asteroid_impacts
			}
			NOR = { 
				has_deposit = d_energy_7
				has_deposit = d_energy_8
				has_deposit = d_energy_9
				has_deposit = d_energy_10
			}
		}
	}

	immediate = {
		from = {
			if = {
				limit = { colonizeable_planet = no }
				prevent_anomaly = yes
				clear_deposits = yes
				add_deposit = d_energy_7
			}
			else_if = {
				limit = {
					OR = {
						habitable_planet = yes
						is_planet_class = pc_nuked
						is_planet_class = pc_hive
					}
				}
				prevent_anomaly = yes
				add_deposit = d_geothermal_vent
			}
		}
	}
}


### Anomaly Events 7 ###
# Limbo - from anomaly_events_2
ship_event = {
	id = anomaly.185
	title = "anomaly.185.name"
	desc = "anomaly.185.desc"
	show_sound = event_radio_chatter
	picture = GFX_evt_archaeological_dig
	location = from
	trackable = yes

	is_triggered_only = yes

	option = {
		name = OK
		from = {
			enable_special_project = {
				name = "LIMBO_1_PROJECT"
				location = this
				owner = root
			}
		}
		if = {
			limit = {
				from = {
					OR = {
						is_planet_class = pc_barren
						is_planet_class = pc_barren_cold
					}
					planet_size > 9
					planet_size < 26
				}
			}
			custom_tooltip = TERRAFORMING_CANDIDATE_EFFECT
			hidden_effect = {
				from = {
					add_modifier = {
						modifier = "terraforming_candidate"
						days = -1
					}
				}		
			}
		}
	}
}